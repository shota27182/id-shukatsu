/*!
 * froala_editor v3.2.0 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2020 Froala Labs
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e,Object.assign(e.POPUP_TEMPLATES,{"file.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_PROGRESS_BAR_]"}),Object.assign(e.DEFAULTS,{fileUpload:!0,fileUploadURL:null,fileUploadParam:"file",fileUploadParams:{},fileUploadToS3:!1,fileUploadToAzure:!1,fileUploadMethod:"POST",fileMaxSize:10485760,fileAllowedTypes:["*"],fileInsertButtons:["fileBack","|"],fileUseSelectedText:!1}),e.PLUGINS.file=function(t){function o(){var e=t.popups.get("file.insert");e||(e=c()),e.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),e.find(".fr-file-progress-bar-layer").addClass("fr-active"),e.find(".fr-buttons").hide(),r(t.language.translate("Uploading"),0)}function i(e){var o=t.popups.get("file.insert");o&&(o.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),o.find(".fr-file-progress-bar-layer").removeClass("fr-active"),o.find(".fr-buttons").show(),e&&(t.events.focus(),t.popups.hide("file.insert")))}function r(e,o){var i=t.popups.get("file.insert");if(i){var r=i.find(".fr-file-progress-bar-layer");r.find("h3").text(e+(o?" ".concat(o,"%"):"")),r.removeClass("fr-error"),o?(r.find("div").removeClass("fr-indeterminate"),r.find("div > span").css("width","".concat(o,"%"))):r.find("div").addClass("fr-indeterminate")}}function a(e,o,i){t.edit.on(),t.events.focus(!0),t.selection.restore(),t.opts.fileUseSelectedText&&t.selection.text().length&&(o=t.selection.text()),t.html.insert('<a href="'.concat(e,'" target="_blank" id="fr-inserted-file" class="fr-file">').concat(o,"</a>"));var r=t.$el.find("#fr-inserted-file");r.removeAttr("id"),t.popups.hide("file.insert"),t.undo.saveStep(),h(),t.events.trigger("file.inserted",[r,i])}function n(e,o,i){var r=this.status,n=this.response,s=this.responseXML,l=this.responseText;try{if(t.opts.fileUploadToS3||t.opts.fileUploadToAzure)if(201===r){var f;if(t.opts.fileUploadToAzure){if(!1===t.events.trigger("file.uploadedToAzure",[this.responseURL,i,n],!0))return t.edit.on(),!1;f=o}else f=function(e){try{var o=m(e).find("Location").text(),i=m(e).find("Key").text();return!1===t.events.trigger("file.uploadedToS3",[o,i,e],!0)?(t.edit.on(),!1):o}catch(r){return p(A,e),!1}}(s);f&&a(f,e,n||s)}else p(A,n||s);else if(200<=r&&r<300){var d=function(e){try{if(!1===t.events.trigger("file.uploaded",[e],!0))return t.edit.on(),!1;var o=JSON.parse(e);return o.link?o:(p(y,e),!1)}catch(i){return p(A,e),!1}}(l);d&&a(d.link,e,n||l)}else p(T,n||l)}catch(u){p(A,n||l)}}function s(){p(A,this.response||this.responseText||this.responseXML)}function l(e){if(e.lengthComputable){var o=e.loaded/e.total*100|0;r(t.language.translate("Uploading"),o)}}function p(e,i){t.edit.on(),function(e){o();var i=t.popups.get("file.insert").find(".fr-file-progress-bar-layer");i.addClass("fr-error");var r=i.find("h3");r.text(e),t.events.disableBlur(),r.focus()}(t.language.translate("Something went wrong. Please try again.")),t.events.trigger("file.error",[{code:e,message:w[e]},i])}function f(){t.edit.on(),i(!0)}function d(e){if(void 0!==e&&0<e.length){if(!1===t.events.trigger("file.beforeUpload",[e]))return!1;var i,r=e[0];if(!(null!==t.opts.fileUploadURL&&t.opts.fileUploadURL!==b||t.opts.fileUploadToS3||t.opts.fileUploadToAzure))return function(e){var i=new FileReader;i.onload=function(){for(var o=i.result,r=atob(i.result.split(",")[1]),a=[],n=0;n<r.length;n++)a.push(r.charCodeAt(n));o=window.URL.createObjectURL(new Blob([new Uint8Array(a)],{type:e.type})),t.file.insert(o,e.name,null)},o(),i.readAsDataURL(e)}(r),!1;if(r.size>t.opts.fileMaxSize)return p(S),!1;if(t.opts.fileAllowedTypes.indexOf("*")<0&&t.opts.fileAllowedTypes.indexOf(r.type.replace(/file\//g,""))<0)return p(P),!1;if(t.drag_support.formdata&&(i=t.drag_support.formdata?new FormData:null),i){var a;if(!1!==t.opts.fileUploadToS3)for(a in i.append("key",t.opts.fileUploadToS3.keyStart+(new Date).getTime()+"-"+(r.name||"untitled")),i.append("success_action_status","201"),i.append("X-Requested-With","xhr"),i.append("Content-Type",r.type),t.opts.fileUploadToS3.params)t.opts.fileUploadToS3.params.hasOwnProperty(a)&&i.append(a,t.opts.fileUploadToS3.params[a]);for(a in t.opts.fileUploadParams)t.opts.fileUploadParams.hasOwnProperty(a)&&i.append(a,t.opts.fileUploadParams[a]);i.append(t.opts.fileUploadParam,r);var d,u,c=t.opts.fileUploadURL;t.opts.fileUploadToS3&&(c=t.opts.fileUploadToS3.uploadURL?t.opts.fileUploadToS3.uploadURL:"https://".concat(t.opts.fileUploadToS3.region,".amazonaws.com/").concat(t.opts.fileUploadToS3.bucket));var v=t.opts.fileUploadMethod;t.opts.fileUploadToAzure&&(c=t.opts.fileUploadToAzure.uploadURL?"".concat(t.opts.fileUploadToAzure.uploadURL,"/").concat(r.name):encodeURI("https://".concat(t.opts.fileUploadToAzure.account,".blob.core.windows.net/").concat(t.opts.fileUploadToAzure.container,"/").concat(r.name)),d=c,t.opts.fileUploadToAzure.SASToken&&(c+=t.opts.fileUploadToAzure.SASToken),v="PUT");var g=t.core.getXHR(c,v);if(t.opts.fileUploadToAzure){var h=(new Date).toUTCString();if(!t.opts.fileUploadToAzure.SASToken&&t.opts.fileUploadToAzure.accessKey){var U=t.opts.fileUploadToAzure.account,m=t.opts.fileUploadToAzure.container;if(t.opts.fileUploadToAzure.uploadURL){var y=t.opts.fileUploadToAzure.uploadURL.split("/");m=y.pop(),U=y.pop().split(".")[0]}var T="x-ms-blob-type:BlockBlob\nx-ms-date:".concat(h,"\nx-ms-version:2019-07-07"),A=encodeURI("/"+U+"/"+m+"/"+r.name),w=v+"\n\n\n"+r.size+"\n\n"+r.type+"\n\n\n\n\n\n\n"+T+"\n"+A,R=t.cryptoJSPlugin.cryptoJS.HmacSHA256(w,t.cryptoJSPlugin.cryptoJS.enc.Base64.parse(t.opts.fileUploadToAzure.accessKey)).toString(t.cryptoJSPlugin.cryptoJS.enc.Base64),k="SharedKey "+U+":"+R;u=R,g.setRequestHeader("Authorization",k)}for(a in g.setRequestHeader("x-ms-version","2019-07-07"),g.setRequestHeader("x-ms-date",h),g.setRequestHeader("Content-Type",r.type),g.setRequestHeader("x-ms-blob-type","BlockBlob"),t.opts.fileUploadParams)t.opts.fileUploadParams.hasOwnProperty(a)&&g.setRequestHeader(a,t.opts.fileUploadParams[a]);for(a in t.opts.fileUploadToAzure.params)t.opts.fileUploadToAzure.params.hasOwnProperty(a)&&g.setRequestHeader(a,t.opts.fileUploadToAzure.params[a])}g.onload=function(){n.call(g,r.name,d,u)},g.onerror=s,g.upload.onprogress=l,g.onabort=f,o();var C=t.popups.get("file.insert");C&&(C.off("abortUpload"),C.on("abortUpload",function(){4!==g.readyState&&g.abort()})),g.send(t.opts.fileUploadToAzure?r:i)}}}function u(){i()}function c(e){if(e)return t.popups.onHide("file.insert",u),!0;var o;t.opts.fileUpload||t.opts.fileInsertButtons.splice(t.opts.fileInsertButtons.indexOf("fileUpload"),1),o='<div class="fr-buttons fr-tabs">'.concat(t.button.buildList(t.opts.fileInsertButtons),"</div>");var i="";t.opts.fileUpload&&(i='<div class="fr-file-upload-layer fr-layer fr-active" id="fr-file-upload-layer-'.concat(t.id,'"><strong>').concat(t.language.translate("Drop file"),"</strong><br>(").concat(t.language.translate("or click"),')<div class="fr-form"><input type="file" name="').concat(t.opts.fileUploadParam,'" accept="').concat(0<=t.opts.fileAllowedTypes.indexOf("*")?"/":"").concat(t.opts.fileAllowedTypes.join(", ").toLowerCase(),'" tabIndex="-1" aria-labelledby="fr-file-upload-layer-').concat(t.id,'" role="button"></div></div>'));var r={buttons:o,upload_layer:i,progress_bar:'<div class="fr-file-progress-bar-layer fr-layer"><h3 tabIndex="-1" class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-dismiss" data-cmd="fileDismissError" tabIndex="2" role="button">OK</button></div></div>'},a=t.popups.create("file.insert",r);return function(e){t.events.$on(e,"dragover dragenter",".fr-file-upload-layer",function(){return m(this).addClass("fr-drop"),!1},!0),t.events.$on(e,"dragleave dragend",".fr-file-upload-layer",function(){return m(this).removeClass("fr-drop"),!1},!0),t.events.$on(e,"drop",".fr-file-upload-layer",function(o){o.preventDefault(),o.stopPropagation(),m(this).removeClass("fr-drop");var i=o.originalEvent.dataTransfer;i&&i.files&&(e.data("instance")||t).file.upload(i.files)},!0),t.helpers.isIOS()&&t.events.$on(e,"touchstart",'.fr-file-upload-layer input[type="file"]',function(){m(this).trigger("click")}),t.events.$on(e,"change",'.fr-file-upload-layer input[type="file"]',function(){if(this.files){var o=e.data("instance")||t;o.events.disableBlur(),e.find("input:focus").blur(),o.events.enableBlur(),o.file.upload(this.files)}m(this).val("")},!0)}(a),a}function v(e){t.node.hasClass(e,"fr-file")}function g(i){var r=i.originalEvent.dataTransfer;if(r&&r.files&&r.files.length){var a=r.files[0];if(a&&"undefined"!=typeof a.type){if(a.type.indexOf("image")<0){if(!t.opts.fileUpload)return i.preventDefault(),i.stopPropagation(),!1;t.markers.remove(),t.markers.insertAtPoint(i.originalEvent),t.$el.find(".fr-marker").replaceWith(e.MARKERS),t.popups.hideAll();var n=t.popups.get("file.insert");return n||(n=c()),t.popups.setContainer("file.insert",t.$sc),t.popups.show("file.insert",i.originalEvent.pageX,i.originalEvent.pageY),o(),d(r.files),i.preventDefault(),i.stopPropagation(),!1}}else a.type.indexOf("image")<0&&(i.preventDefault(),i.stopPropagation())}}function h(){var e,o=Array.prototype.slice.call(t.el.querySelectorAll("a.fr-file")),i=[];for(e=0;e<o.length;e++)i.push(o[e].getAttribute("href"));if(U)for(e=0;e<U.length;e++)i.indexOf(U[e].getAttribute("href"))<0&&t.events.trigger("file.unlink",[U[e]]);U=o}var U,m=t.$,b="https://i.froala.com/upload",y=2,T=3,A=4,S=5,P=6,w={1:"File cannot be loaded from the passed link."};return w[y]="No link in upload response.",w[T]="Error during file upload.",w[A]="Parsing response failed.",w[S]="File is too large.",w[P]="File file type is invalid.",w[7]="Files can be uploaded only to same domain in IE 8 and IE 9.",{_init:function(){t.events.on("drop",g),t.events.$on(t.$win,"keydown",function(o){var i=o.which,r=t.popups.get("file.insert");r&&i===e.KEYCODE.ESC&&r.trigger("abortUpload")}),t.events.on("destroy",function(){var e=t.popups.get("file.insert");e&&e.trigger("abortUpload")}),t.events.on("link.beforeRemove",v),t.$wp&&(h(),t.events.on("contentChanged",h)),c(!0)},showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertFile"]'),o=t.popups.get("file.insert");if(o||(o=c()),i(),!o.hasClass("fr-active"))if(t.popups.refresh("file.insert"),t.popups.setContainer("file.insert",t.$tb),e.isVisible){var r=t.button.getPosition(e),a=r.left,n=r.top;t.popups.show("file.insert",a,n,e.outerHeight())}else t.position.forSelection(o),t.popups.show("file.insert")},upload:d,insert:a,back:function(){t.events.disableBlur(),t.selection.restore(),t.events.enableBlur(),t.popups.hide("file.insert"),t.toolbar.showInline()},hideProgressBar:i}},e.DefineIcon("insertFile",{NAME:"file-o",FA5NAME:"file",SVG_KEY:"insertFile"}),e.RegisterCommand("insertFile",{title:"Upload File",undo:!1,focus:!0,refreshAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("file.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("file.insert")):this.file.showInsertPopup()},plugin:"file"}),e.DefineIcon("fileBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("fileBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.file.back()},refresh:function(e){this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.RegisterCommand("fileDismissError",{title:"OK",callback:function(){this.file.hideProgressBar(!0)}})});