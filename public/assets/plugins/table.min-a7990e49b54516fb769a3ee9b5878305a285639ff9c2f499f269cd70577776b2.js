/*!
 * froala_editor v3.2.0 (https://www.froala.com/wysiwyg-editor)
 * License https://froala.com/wysiwyg-editor/terms/
 * Copyright 2014-2020 Froala Labs
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("froala-editor")):"function"==typeof define&&define.amd?define(["froala-editor"],t):t(e.FroalaEditor)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e,Object.assign(e.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_][_CUSTOM_COLOR_]"}),Object.assign(e.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizer:!0,tableDefaultWidth:"100%",tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),e.PLUGINS.table=function(t){function a(){var e=b();if(e){var a=t.popups.get("table.edit");if(a||(a=s()),a){t.popups.setContainer("table.edit",t.$sc);var l=R(e),n=l.left+(l.right-l.left)/2,r=l.bottom;t.popups.show("table.edit",n,r,l.bottom-l.top,!0),t.edit.isDisabled()&&(1<P().length&&t.toolbar.disable(),t.$el.removeClass("fr-no-selection"),t.edit.on(),t.button.bulkRefresh(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell").last().get(0)),t.selection.restore())}}}function l(){var a=b();if(a){var n=t.popups.get("table.colors");n||(n=function(){var a="";0<t.opts.tableColorsButtons.length&&(a='<div class="fr-buttons fr-tabs">'.concat(t.button.buildList(t.opts.tableColorsButtons),"</div>"));var n="";t.opts.colorsHEXInput&&(n='<div class="fr-color-hex-layer fr-table-colors-hex-layer fr-active fr-layer" id="fr-table-colors-hex-layer-'.concat(t.id,'"><div class="fr-input-line"><input maxlength="7" id="fr-table-colors-hex-layer-text-').concat(t.id,'" type="text" placeholder="').concat(t.language.translate("HEX Color"),'" tabIndex="1" aria-required="true"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="tableCellBackgroundCustomColor" tabIndex="2" role="button">').concat(t.language.translate("OK"),"</button></div></div>"));var r,o={buttons:a,colors:function(){for(var e='<div class="fr-color-set fr-table-colors">',a=0;a<t.opts.tableColors.length;a++)0!==a&&a%t.opts.tableColorsStep==0&&(e+="<br>"),"REMOVE"!=t.opts.tableColors[a]?e+='<span class="fr-command" style="background: '.concat(t.opts.tableColors[a],';" tabIndex="-1" role="button" data-cmd="tableCellBackgroundColor" data-param1="').concat(t.opts.tableColors[a],'"><span class="fr-sr-only">').concat(t.language.translate("Color")," ").concat(t.opts.tableColors[a],"&nbsp;&nbsp;&nbsp;</span></span>"):e+='<span class="fr-command" data-cmd="tableCellBackgroundColor" tabIndex="-1" role="button" data-param1="REMOVE" title="'.concat(t.language.translate("Clear Formatting"),'">').concat(t.icon.create("tableColorRemove"),'<span class="fr-sr-only">').concat(t.language.translate("Clear Formatting"),"</span></span>");return e+"</div>"}(),custom_color:n},s=t.popups.create("table.colors",o);return t.events.$on(t.$wp,"scroll.table-colors",function(){t.popups.isVisible("table.colors")&&l()}),r=s,t.events.on("popup.tab",function(a){var l=te(a.currentTarget);if(!t.popups.isVisible("table.colors")||!l.is("span"))return!0;var n=a.which,o=!0;if(e.KEYCODE.TAB==n){var s=r.find(".fr-buttons");o=!t.accessibility.focusToolbar(s,!!a.shiftKey)}else if(e.KEYCODE.ARROW_UP==n||e.KEYCODE.ARROW_DOWN==n||e.KEYCODE.ARROW_LEFT==n||e.KEYCODE.ARROW_RIGHT==n){var i=l.parent().find("span.fr-command"),f=i.index(l),c=t.opts.colorsStep,d=Math.floor(i.length/c),p=f%c,h=Math.floor(f/c)*c+p,u=d*c;e.KEYCODE.ARROW_UP==n?h=((h-c)%u+u)%u:e.KEYCODE.ARROW_DOWN==n?h=(h+c)%u:e.KEYCODE.ARROW_LEFT==n?h=((h-1)%u+u)%u:e.KEYCODE.ARROW_RIGHT==n&&(h=(h+1)%u);var b=te(i.get(h));t.events.disableBlur(),b.focus(),o=!1}else e.KEYCODE.ENTER==n&&(t.button.exec(l),o=!1);return!1===o&&(a.preventDefault(),a.stopPropagation()),o},!0),s}()),t.popups.setContainer("table.colors",t.$sc);var r=R(a),o=(r.left+r.right)/2,s=r.bottom;!function(){var e=t.popups.get("table.colors"),a=t.$el.find(".fr-selected-cell").first(),l=t.helpers.RGBToHex(a.css("background-color")),n=e.find(".fr-table-colors-hex-layer input");e.find(".fr-selected-color").removeClass("fr-selected-color fr-active-item"),e.find('span[data-param1="'.concat(l,'"]')).addClass("fr-selected-color fr-active-item"),n.val(l).trigger("change")}(),t.popups.show("table.colors",o,s,r.bottom-r.top,!0)}}function n(){0===P().length&&t.toolbar.enable()}function r(a){if(a)return t.popups.onHide("table.insert",function(){t.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseover")}),!0;var l="";0<t.opts.tableInsertButtons.length&&(l='<div class="fr-buttons fr-tabs">'.concat(t.button.buildList(t.opts.tableInsertButtons),"</div>"));var n={buttons:l,rows_columns:function(){for(var e='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',a=1;a<=t.opts.tableInsertMaxSize;a++){for(var l=1;l<=t.opts.tableInsertMaxSize;l++){var n="inline-block";2<a&&!t.helpers.isMobile()&&(n="none");var r="fr-table-cell ";1==a&&1==l&&(r+=" hover"),e+='<span class="fr-command '.concat(r,'" tabIndex="-1" data-cmd="tableInsert" data-row="').concat(a,'" data-col="').concat(l,'" data-param1="').concat(a,'" data-param2="').concat(l,'" style="display: ').concat(n,';" role="button"><span></span><span class="fr-sr-only">').concat(a," &times; ").concat(l,"&nbsp;&nbsp;&nbsp;</span></span>")}e+='<div class="new-line"></div>'}return e+"</div></div>"}()},r=t.popups.create("table.insert",n);return t.events.$on(r,"mouseover",".fr-table-size .fr-select-table-size .fr-table-cell",function(e){o(te(e.currentTarget))},!0),function(a){t.events.$on(a,"focus","[tabIndex]",function(e){o(te(e.currentTarget))}),t.events.on("popup.tab",function(a){var l=te(a.currentTarget);if(!t.popups.isVisible("table.insert")||!l.is("span, a"))return!0;var n,r=a.which;if(e.KEYCODE.ARROW_UP==r||e.KEYCODE.ARROW_DOWN==r||e.KEYCODE.ARROW_LEFT==r||e.KEYCODE.ARROW_RIGHT==r){if(l.is("span.fr-table-cell")){var s=l.parent().find("span.fr-table-cell"),i=s.index(l),f=t.opts.tableInsertMaxSize,c=i%f,d=Math.floor(i/f);e.KEYCODE.ARROW_UP==r?d=Math.max(0,d-1):e.KEYCODE.ARROW_DOWN==r?d=Math.min(t.opts.tableInsertMaxSize-1,d+1):e.KEYCODE.ARROW_LEFT==r?c=Math.max(0,c-1):e.KEYCODE.ARROW_RIGHT==r&&(c=Math.min(t.opts.tableInsertMaxSize-1,c+1));var p=d*f+c,h=te(s.get(p));o(h),t.events.disableBlur(),h.focus(),n=!1}}else e.KEYCODE.ENTER==r&&(t.button.exec(l),n=!1);return!1===n&&(a.preventDefault(),a.stopPropagation()),n},!0)}(r),r}function o(e){var a=e.data("row");null!==a&&(a=parseInt(a));var l=e.data("col");null!==l&&(l=parseInt(l));var n=e.parent();n.siblings(".fr-table-size-info").html("".concat(a," &times; ").concat(l)),n.find("> span").removeClass("hover fr-active-item");for(var r=1;r<=t.opts.tableInsertMaxSize;r++)for(var o=0;o<=t.opts.tableInsertMaxSize;o++){var s=n.find('> span[data-row="'.concat(r,'"][data-col="').concat(o,'"]'));r<=a&&o<=l?s.addClass("hover"):r<=a+1||r<=2&&!t.helpers.isMobile()?s.css("display","inline-block"):2<r&&!t.helpers.isMobile()&&s.css("display","none")}e.addClass("fr-active-item")}function s(e){if(e)return t.popups.onHide("table.edit",n),!0;if(0<t.opts.tableEditButtons.length){var l={buttons:'<div class="fr-buttons">'.concat(t.button.buildList(t.opts.tableEditButtons),"</div>")},r=t.popups.create("table.edit",l);return t.events.$on(t.$wp,"scroll.table-edit",function(){t.popups.isVisible("table.edit")&&a()}),r}return!1}function i(){if(0<P().length){var e=j();t.selection.setBefore(e.get(0))||t.selection.setAfter(e.get(0)),t.selection.restore(),t.popups.hide("table.edit"),e.remove(),t.toolbar.enable()}}function f(e){var l=j();if(0<l.length){if(0<t.$el.find("th.fr-selected-cell").length&&"above"==e)return;var n,r,o,s=b(),i=E(s);if(null==i)return;r="above"==e?i.min_i:i.max_i;var f="<tr>";for(n=0;n<s[r].length;n++)if("below"==e&&r<s.length-1&&s[r][n]==s[r+1][n]||"above"==e&&0<r&&s[r][n]==s[r-1][n]){if(0===n||0<n&&s[r][n]!=s[r][n-1]){var c=te(s[r][n]);c.attr("rowspan",parseInt(c.attr("rowspan"),10)+1)}}else f+='<td style="'+te(s[r][n]).attr("style")+'" ><br></td>';f+="</tr>",o=0<t.$el.find("th.fr-selected-cell").length&&"below"==e?te(l.find("tbody").not(l.find("> table tbody"))):te(l.find("tr").not(l.find("> table tr")).get(r)),"below"==e?"TBODY"==o.attr("tagName")?o.prepend(f):o[0].parentNode&&o[0].insertAdjacentHTML("afterend",f):"above"==e&&(o.before(f),t.popups.isVisible("table.edit")&&a())}}function c(e,t,a){var l,n,r,o,s,i=0,f=b(a);if(e<(t=Math.min(t,f[0].length-1)))for(n=e;n<=t;n++)if(!(e<n&&f[0][n]==f[0][n-1])&&1<(o=Math.min(parseInt(f[0][n].getAttribute("colspan"),10)||1,t-e+1))&&f[0][n]==f[0][n+1])for(i=o-1,l=1;l<f.length;l++)if(f[l][n]!=f[l-1][n]){for(r=n;r<n+o;r++)if(1<(s=parseInt(f[l][r].getAttribute("colspan"),10)||1)&&f[l][r]==f[l][r+1])r+=i=Math.min(i,s-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&p(f,i,"colspan",0,f.length-1,e,t)}function d(e,t,a){var l,n,r,o,s,i=0,f=b(a);if(e<(t=Math.min(t,f.length-1)))for(l=e;l<=t;l++)if(!(e<l&&f[l][0]==f[l-1][0])&&1<(o=Math.min(parseInt(f[l][0].getAttribute("rowspan"),10)||1,t-e+1))&&f[l][0]==f[l+1][0])for(i=o-1,n=1;n<f[0].length;n++)if(f[l][n]!=f[l][n-1]){for(r=l;r<l+o;r++)if(1<(s=parseInt(f[r][n].getAttribute("rowspan"),10)||1)&&f[r][n]==f[r+1][n])r+=i=Math.min(i,s-1);else if(!(i=Math.max(0,i-1)))break;if(!i)break}i&&p(f,i,"rowspan",e,t,0,f[0].length-1)}function p(e,t,a,l,n,r,o){var s,i,f;for(s=l;s<=n;s++)for(i=r;i<=o;i++)l<s&&e[s][i]==e[s-1][i]||r<i&&e[s][i]==e[s][i-1]||1<(f=parseInt(e[s][i].getAttribute(a),10)||1)&&(1<f-t?e[s][i].setAttribute(a,f-t):e[s][i].removeAttribute(a))}function h(e,t,a,l,n){d(e,t,n),c(a,l,n)}function u(e){var l=t.$el.find(".fr-selected-cell");"REMOVE"!=e?l.css("background-color",t.helpers.HEXtoRGB(e)):l.css("background-color",""),a()}function b(e){var t=[];return null==(e=e||null)&&0<P().length&&(e=j()),e&&e.findVisible("tr").not(e.find("> table tr")).each(function(e,a){var l=te(a),n=0;l.find("> th, > td").each(function(a,l){for(var r=te(l),o=parseInt(r.attr("colspan"),10)||1,s=parseInt(r.attr("rowspan"),10)||1,i=e;i<e+s;i++)for(var f=n;f<n+o;f++)t[i]||(t[i]=[]),t[i][f]?n++:t[i][f]=l;n+=o})}),t}function g(e,t){for(var a=0;a<t.length;a++)for(var l=0;l<t[a].length;l++)if(t[a][l]==e)return{row:a,col:l}}function m(e,t,a){for(var l=e+1,n=t+1;l<a.length;){if(a[l][t]!=a[e][t]){l--;break}l++}for(l==a.length&&l--;n<a[e].length;){if(a[e][n]!=a[e][t]){n--;break}n++}return n==a[e].length&&n--,{row:l,col:n}}function v(){t.el.querySelector(".fr-cell-fixed")&&t.el.querySelector(".fr-cell-fixed").classList.remove("fr-cell-fixed"),t.el.querySelector(".fr-cell-handler")&&t.el.querySelector(".fr-cell-handler").classList.remove("fr-cell-handler")}function w(){var e=t.$el.find(".fr-selected-cell");0<e.length&&e.each(function(){var e=te(this);e.removeClass("fr-selected-cell"),""===e.attr("class")&&e.removeAttr("class")}),v()}function C(){t.events.disableBlur(),t.selection.clear(),t.$el.addClass("fr-no-selection"),t.$el.blur(),t.events.enableBlur()}function E(e){var a=t.$el.find(".fr-selected-cell");if(0<a.length){var l,n=e.length,r=0,o=e[0].length,s=0;for(l=0;l<a.length;l++){var i=g(a[l],e),f=m(i.row,i.col,e);n=Math.min(i.row,n),r=Math.max(f.row,r),o=Math.min(i.col,o),s=Math.max(f.col,s)}return{min_i:n,max_i:r,min_j:o,max_j:s}}return null}function R(e){var t=E(e);if(null!=t){var a=te(e[t.min_i][t.min_j]),l=te(e[t.min_i][t.max_j]),n=te(e[t.max_i][t.min_j]);return{left:a.length&&a.offset().left,right:l.length&&l.offset().left+l.outerWidth(),top:a.length&&a.offset().top,bottom:n.length&&n.offset().top+n.outerHeight()}}}function O(e,a){if(te(e).is(a))w(),te(e).addClass("fr-selected-cell");else{C(),t.edit.off();var l=b(),n=g(e,l),r=g(a,l),o=function f(e,t,a,l,n){var r,o,s,i,c=e,d=t,p=a,h=l;for(r=c;r<=d;r++)(1<(parseInt(te(n[r][p]).attr("rowspan"),10)||1)||1<(parseInt(te(n[r][p]).attr("colspan"),10)||1))&&(i=m((s=g(n[r][p],n)).row,s.col,n),c=Math.min(s.row,c),d=Math.max(i.row,d),p=Math.min(s.col,p),h=Math.max(i.col,h)),(1<(parseInt(te(n[r][h]).attr("rowspan"),10)||1)||1<(parseInt(te(n[r][h]).attr("colspan"),10)||1))&&(i=m((s=g(n[r][h],n)).row,s.col,n),c=Math.min(s.row,c),d=Math.max(i.row,d),p=Math.min(s.col,p),h=Math.max(i.col,h));for(o=p;o<=h;o++)(1<(parseInt(te(n[c][o]).attr("rowspan"),10)||1)||1<(parseInt(te(n[c][o]).attr("colspan"),10)||1))&&(i=m((s=g(n[c][o],n)).row,s.col,n),c=Math.min(s.row,c),d=Math.max(i.row,d),p=Math.min(s.col,p),h=Math.max(i.col,h)),(1<(parseInt(te(n[d][o]).attr("rowspan"),10)||1)||1<(parseInt(te(n[d][o]).attr("colspan"),10)||1))&&(i=m((s=g(n[d][o],n)).row,s.col,n),c=Math.min(s.row,c),d=Math.max(i.row,d),p=Math.min(s.col,p),h=Math.max(i.col,h));return c==e&&d==t&&p==a&&h==l?{min_i:e,max_i:t,min_j:a,max_j:l}:f(c,d,p,h,n)}(Math.min(n.row,r.row),Math.max(n.row,r.row),Math.min(n.col,r.col),Math.max(n.col,r.col),l);w(),e.classList.add("fr-cell-fixed"),a.classList.add("fr-cell-handler");for(var s=o.min_i;s<=o.max_i;s++)for(var i=o.min_j;i<=o.max_j;i++)te(l[s][i]).addClass("fr-selected-cell")}}function A(e){var a=null,l=te(e.target);return"TD"==e.target.tagName||"TH"==e.target.tagName?a=e.target:0<l.closest("th",l.closest("thead")[0]).length?a=l.closest("th",l.closest("thead")[0]).get(0):0<l.closest("td",l.closest("tr")[0]).length&&(a=l.closest("td",l.closest("tr")[0]).get(0)),-1===t.$el.html.toString().search(a)?null:a}function x(){w(),t.popups.hide("table.edit")}function _(e){var a=A(e);if("false"==te(a).parents("[contenteditable]").not(".fr-element").not(".fr-img-caption").not("body").first().attr("contenteditable"))return!0;if(0<P().length&&!a&&x(),!t.edit.isDisabled()||t.popups.isVisible("table.edit"))if(1!=e.which||1==e.which&&t.helpers.isMac()&&e.ctrlKey)(3==e.which||1==e.which&&t.helpers.isMac()&&e.ctrlKey)&&a&&x();else if(J=!0,a){0<P().length&&!e.shiftKey&&x(),e.stopPropagation(),t.events.trigger("image.hideResizer"),t.events.trigger("video.hideResizer"),q=!0;var l=a.tagName.toLowerCase();e.shiftKey&&0<t.$el.find("".concat(l,".fr-selected-cell")).length?te(t.$el.find("".concat(l,".fr-selected-cell")).closest("table")).is(te(a).closest("table"))?O(Z,a):C():((t.keys.ctrlKey(e)||e.shiftKey)&&(1<P().length||0===te(a).find(t.selection.element()).length&&!te(a).is(t.selection.element()))&&C(),Z=a,0<t.opts.tableEditButtons.length&&O(Z,Z))}}function $(e){if(!t.edit.isDisabled()&&t.popups.areVisible())return!0;if(q||t.$tb.is(e.target)||t.$tb.is(te(e.target).closest(".fr-toolbar"))||(0<P().length&&t.toolbar.enable(),w()),!(1!=e.which||1==e.which&&t.helpers.isMac()&&e.ctrlKey)&&(J=!1,q&&(q=!1,A(e)||1!=P().length?0<P().length&&(t.selection.isCollapsed()?a():(w(),t.edit.on())):w()),ee)){ee=!1,G.removeClass("fr-moving"),t.$el.removeClass("fr-no-selection"),t.edit.on();var l=parseFloat(G.css("left"))+t.opts.tableResizerOffset+t.$wp.offset().left;t.opts.iframe&&(l-=t.$iframe.offset().left),G.data("release-position",l),G.removeData("max-left"),G.removeData("max-right"),function(){var e=G.data("origin"),a=G.data("release-position");if(e!==a){var l=G.data("first"),n=G.data("second"),r=G.data("table"),o=r.outerWidth();if(t.undo.canDo()||t.undo.saveStep(),null!=l&&null!=n){var s,i,f,c=b(r),d=[],p=[],h=[],u=[];for(s=0;s<c.length;s++)i=te(c[s][l]),f=te(c[s][n]),d[s]=i.outerWidth(),h[s]=f.outerWidth(),p[s]=d[s]/o*100,u[s]=h[s]/o*100;for(s=0;s<c.length;s++)if(i=te(c[s][l]),f=te(c[s][n]),c[s][l]!=c[s][n]){var g=(p[s]*(d[s]+a-e)/d[s]).toFixed(4);i.css("width",g+"%"),f.css("width",(p[s]+u[s]-g).toFixed(4)+"%")}}else{var m,v=r.parent(),w=o/v.width()*100,C=(parseInt(r.css("margin-left"),10)||0)/v.width()*100,E=(parseInt(r.css("margin-right"),10)||0)/v.width()*100;"rtl"==t.opts.direction&&0===n||"rtl"!=t.opts.direction&&0!==n?(m=(o+a-e)/o*w,r.css("margin-right","calc(100% - ".concat(Math.round(m).toFixed(4),"% - ").concat(Math.round(C).toFixed(4),"%)"))):("rtl"==t.opts.direction&&0!==n||"rtl"!=t.opts.direction&&0===n)&&(m=(o-a+e)/o*w,r.css("margin-left","calc(100% - ".concat(Math.round(m).toFixed(4),"% - ").concat(Math.round(E).toFixed(4),"%)"))),r.css("width","".concat(Math.round(m).toFixed(4),"%"))}t.selection.restore(),t.undo.saveStep(),t.events.trigger("table.resized",[r.get(0)])}G.removeData("origin"),G.removeData("release-position"),G.removeData("first"),G.removeData("second"),G.removeData("table")}(),I()}}function D(e){if(t.events.$on(te("input"),"click",X),!0===q&&0<t.opts.tableEditButtons.length){if(te(e.currentTarget).closest("table").is(j())){if("TD"==e.currentTarget.tagName&&0===t.$el.find("th.fr-selected-cell").length)return void O(Z,e.currentTarget);if("TH"==e.currentTarget.tagName&&0===t.$el.find("td.fr-selected-cell").length)return void O(Z,e.currentTarget)}C()}}function y(e,a,l,n){for(var r,o=a;o!=t.el&&"TD"!=o.tagName&&"TH"!=o.tagName&&("up"==n?r=o.previousElementSibling:"down"==n&&(r=o.nextElementSibling),!r);)o=o.parentNode;"TD"==o.tagName||"TH"==o.tagName?function(e,a){for(var l=e;l&&"TABLE"!=l.tagName&&l.parentNode!=t.el;)l=l.parentNode;if(l&&"TABLE"==l.tagName){var n=b(te(l));"up"==a?M(g(e,n),l,n):"down"==a&&S(g(e,n),l,n)}}(o,n):r&&("up"==n&&t.selection.setAtEnd(r),"down"==n&&t.selection.setAtStart(r))}function M(e,a,l){0<e.row?t.selection.setAtEnd(l[e.row-1][e.col]):y(0,a,0,"up")}function S(e,a,l){var n=parseInt(l[e.row][e.col].getAttribute("rowspan"),10)||1;e.row<l.length-n?t.selection.setAtStart(l[e.row+n][e.col]):y(0,a,0,"down")}function I(){G&&(G.find("div").css("opacity",0),G.css("top",0),G.css("left",0),G.css("height",0),G.find("div").css("height",0),G.hide())}function N(){U&&U.removeClass("fr-visible").css("left","-9999px")}function T(e,a){var l=te(a),n=l.closest("table"),r=n.parent();if(a&&"TD"!=a.tagName&&"TH"!=a.tagName&&(0<l.closest("td").length?a=l.closest("td"):0<l.closest("th").length&&(a=l.closest("th"))),!a||"TD"!=a.tagName&&"TH"!=a.tagName)G&&l.get(0)!=G.get(0)&&l.parent().get(0)!=G.get(0)&&t.core.sameInstance(G)&&I();else{if(l=te(a),0===t.$el.find(l).length)return!1;var o=l.offset().left-1,s=o+l.outerWidth();if(Math.abs(e.pageX-o)<=t.opts.tableResizerOffset||Math.abs(s-e.pageX)<=t.opts.tableResizerOffset){var i,f,c,d,p,h=b(n),u=g(a,h),v=m(u.row,u.col,h),w=n.offset().top,E=n.outerHeight()-1;"rtl"!=t.opts.direction?e.pageX-o<=t.opts.tableResizerOffset?(c=o,0<u.col?(d=o-Y(u.col-1,h)+t.opts.tableResizingLimit,p=o+Y(u.col,h)-t.opts.tableResizingLimit,i=u.col-1,f=u.col):(i=null,f=0,d=n.offset().left-1-parseInt(n.css("margin-left"),10),p=n.offset().left-1+n.width()-h[0].length*t.opts.tableResizingLimit)):s-e.pageX<=t.opts.tableResizerOffset&&(c=s,v.col<h[v.row].length&&h[v.row][v.col+1]?(d=s-Y(v.col,h)+t.opts.tableResizingLimit,p=s+Y(v.col+1,h)-t.opts.tableResizingLimit,i=v.col,f=v.col+1):(i=v.col,f=null,d=n.offset().left-1+h[0].length*t.opts.tableResizingLimit,p=r.offset().left-1+r.width()+parseFloat(r.css("padding-left")))):s-e.pageX<=t.opts.tableResizerOffset?(c=s,0<u.col?(d=s-Y(u.col,h)+t.opts.tableResizingLimit,p=s+Y(u.col-1,h)-t.opts.tableResizingLimit,i=u.col,f=u.col-1):(i=null,f=0,d=n.offset().left+h[0].length*t.opts.tableResizingLimit,p=r.offset().left-1+r.width()+parseFloat(r.css("padding-left")))):e.pageX-o<=t.opts.tableResizerOffset&&(c=o,v.col<h[v.row].length&&h[v.row][v.col+1]?(d=o-Y(v.col+1,h)+t.opts.tableResizingLimit,p=o+Y(v.col,h)-t.opts.tableResizingLimit,i=v.col+1,f=v.col):(i=v.col,f=null,d=r.offset().left+parseFloat(r.css("padding-left")),p=n.offset().left-1+n.width()-h[0].length*t.opts.tableResizingLimit)),G||(t.shared.$table_resizer||(t.shared.$table_resizer=te(document.createElement("div")).attr("class","fr-table-resizer").html("<div></div>")),G=t.shared.$table_resizer,t.events.$on(G,"mousedown",function(e){return!t.core.sameInstance(G)||(0<P().length&&x(),1==e.which?(t.selection.save(),ee=!0,G.addClass("fr-moving"),C(),t.edit.off(),G.find("div").css("opacity",1),!1):void 0)}),t.events.$on(G,"mousemove",function(e){if(!t.core.sameInstance(G))return!0;ee&&(t.opts.iframe&&(e.pageX-=t.$iframe.offset().left),L(e))}),t.events.on("shared.destroy",function(){G.html("").removeData().remove(),G=null},!0),t.events.on("destroy",function(){t.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),te("body").first().append(G.hide())},!0)),G.data("table",n),G.data("first",i),G.data("second",f),G.data("instance",t),t.$wp.append(G);var R=c-t.win.pageXOffset-t.opts.tableResizerOffset-t.$wp.offset().left,O=w-t.$wp.offset().top+t.$wp.scrollTop();if(t.opts.iframe){var A=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),_=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"));R+=t.$iframe.offset().left+_,O+=t.$iframe.offset().top+A,d+=t.$iframe.offset().left,p+=t.$iframe.offset().left}G.data("max-left",d),G.data("max-right",p),G.data("origin",c-t.win.pageXOffset),G.css("top",O),G.css("left",R),G.css("height",E),G.find("div").css("height",E),G.css("padding-left",t.opts.tableResizerOffset),G.css("padding-right",t.opts.tableResizerOffset),G.show()}else t.core.sameInstance(G)&&I()}}function K(e,a){if(t.$box.find(".fr-line-breaker").isVisible())return!1;U||H(),t.$box.append(U),U.data("instance",t);var l,n=te(a).find("tr").first(),r=e.pageX,o=0,s=0;if(t.opts.iframe){var i=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),f=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"));o+=t.$iframe.offset().left-t.helpers.scrollLeft()+f,s+=t.$iframe.offset().top-t.helpers.scrollTop()+i}n.find("th, td").each(function(){var e=te(this);return e.offset().left<=r&&r<e.offset().left+e.outerWidth()/2?(l=parseInt(U.find("a").css("width"),10),U.css("top",s+e.offset().top-t.$box.offset().top-l-5),U.css("left",o+e.offset().left-t.$box.offset().left-l/2),U.data("selected-cell",e),U.data("position","before"),U.addClass("fr-visible"),!1):e.offset().left+e.outerWidth()/2<=r&&r<e.offset().left+e.outerWidth()?(l=parseInt(U.find("a").css("width"),10),U.css("top",s+e.offset().top-t.$box.offset().top-l-5),U.css("left",o+e.offset().left-t.$box.offset().left+e.outerWidth()-l/2),U.data("selected-cell",e),U.data("position","after"),U.addClass("fr-visible"),!1):void 0})}function B(e,a){if(t.$box.find(".fr-line-breaker").isVisible())return!1;U||H(),t.$box.append(U),U.data("instance",t);var l,n=te(a),r=e.pageY,o=0,s=0;if(t.opts.iframe){var i=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top")),f=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-left"));o+=t.$iframe.offset().left-t.helpers.scrollLeft()+f,s+=t.$iframe.offset().top-t.helpers.scrollTop()+i}n.find("tr").each(function(){var e=te(this);return e.offset().top<=r&&r<e.offset().top+e.outerHeight()/2?(l=parseInt(U.find("a").css("width"),10),U.css("top",s+e.offset().top-t.$box.offset().top-l/2),U.css("left",o+e.offset().left-t.$box.offset().left-l-5),U.data("selected-cell",e.find("td").first()),U.data("position","above"),U.addClass("fr-visible"),!1):e.offset().top+e.outerHeight()/2<=r&&r<e.offset().top+e.outerHeight()?(l=parseInt(U.find("a").css("width"),10),U.css("top",s+e.offset().top-t.$box.offset().top+e.outerHeight()-l/2),U.css("left",o+e.offset().left-t.$box.offset().left-l-5),U.data("selected-cell",e.find("td").first()),U.data("position","below"),U.addClass("fr-visible"),!1):void 0})}function z(e){Q=null;var a=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset);t.opts.tableResizer&&(!t.popups.areVisible()||t.popups.areVisible()&&t.popups.isVisible("table.edit"))&&T(e,a),!t.opts.tableInsertHelper||t.popups.areVisible()||t.$tb.hasClass("fr-inline")&&t.$tb.isVisible()||function(e,a){if(0===P().length){var l,n,r;if(a&&("HTML"==a.tagName||"BODY"==a.tagName||t.node.isElement(a)))for(l=1;l<=t.opts.tableInsertHelperOffset;l++){if(n=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset,e.pageY-t.win.pageYOffset+l),te(n).hasClass("fr-tooltip"))return!0;if(n&&("TH"==n.tagName||"TD"==n.tagName||"TABLE"==n.tagName)&&(te(n).parents(".fr-wrapper").length||t.opts.iframe)&&"false"!=te(n).closest("table").attr("contenteditable"))return K(e,te(n).closest("table")),!0;if(r=t.doc.elementFromPoint(e.pageX-t.win.pageXOffset+l,e.pageY-t.win.pageYOffset),te(r).hasClass("fr-tooltip"))return!0;if(r&&("TH"==r.tagName||"TD"==r.tagName||"TABLE"==r.tagName)&&(te(r).parents(".fr-wrapper").length||t.opts.iframe)&&"false"!=te(r).closest("table").attr("contenteditable"))return B(e,te(r).closest("table")),!0}t.core.sameInstance(U)&&N()}}(e,a)}function k(){if(ee){var e=G.data("table").offset().top-t.win.pageYOffset;if(t.opts.iframe){var a=t.helpers.getPX(t.$wp.find(".fr-iframe").css("padding-top"));e+=t.$iframe.offset().top-t.helpers.scrollTop()+a}G.css("top",e)}}function Y(e,t){var a,l=te(t[0][e]).outerWidth();for(a=1;a<t.length;a++)l=Math.min(l,te(t[a][e]).outerWidth());return l}function W(e,t,a){var l,n=0;for(l=e;l<=t;l++)n+=Y(l,a);return n}function L(e){if(1<P().length&&J&&C(),!1===J&&!1===q&&!1===ee)Q&&clearTimeout(Q),t.edit.isDisabled()&&!t.popups.isVisible("table.edit")||(Q=setTimeout(z,30,e));else if(ee){var a=e.pageX-t.win.pageXOffset;t.opts.iframe&&(a+=t.$iframe.offset().left);var l=G.data("max-left"),n=G.data("max-right");l<=a&&a<=n?G.css("left",a-t.opts.tableResizerOffset-t.$wp.offset().left):a<l&&parseFloat(G.css("left"),10)>l-t.opts.tableResizerOffset?G.css("left",l-t.opts.tableResizerOffset-t.$wp.offset().left):n<a&&parseFloat(G.css("left"),10)<n-t.opts.tableResizerOffset&&G.css("left",n-t.opts.tableResizerOffset-t.$wp.offset().left)}else J&&N()}function F(a){t.node.isEmpty(a.get(0))?a.prepend(e.MARKERS):a.prepend(e.START_MARKER).append(e.END_MARKER)}function H(){t.shared.$ti_helper||(t.shared.$ti_helper=te(document.createElement("div")).attr("class","fr-insert-helper").html('<a class="fr-floating-btn" role="button" tabIndex="-1" title="'.concat(t.language.translate("Insert"),'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a>')),t.events.bindClick(t.shared.$ti_helper,"a",function(){var e=U.data("selected-cell"),a=U.data("position"),l=U.data("instance")||t;"before"==a?(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertColumn(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"after"==a?(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertColumn(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"above"==a?(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertRow(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()):"below"==a&&(t.undo.saveStep(),e.addClass("fr-selected-cell"),l.table.insertRow(a),e.removeClass("fr-selected-cell"),t.undo.saveStep()),N()}),t.events.on("shared.destroy",function(){t.shared.$ti_helper.html("").removeData().remove(),t.shared.$ti_helper=null},!0),t.events.$on(t.shared.$ti_helper,"mousemove",function(e){e.stopPropagation()},!0),t.events.$on(te(t.o_win),"scroll",function(){N()},!0),t.events.$on(t.$wp,"scroll",function(){N()},!0)),U=t.shared.$ti_helper,t.events.on("destroy",function(){U=null}),t.tooltip.bind(t.$box,".fr-insert-helper > a.fr-floating-btn")}function V(){Z=null,clearTimeout(Q)}function P(){return t.el.querySelectorAll(".fr-selected-cell")}function j(){var e=P();if(e.length){for(var a=e[0];a&&"TABLE"!=a.tagName&&a.parentNode!=t.el;)a=a.parentNode;return a&&"TABLE"==a.tagName?te(a):te([])}return te([])}function X(){q=!1}var G,U,q,J,Z,Q,ee,te=t.$;return{_init:function(){if(!t.$wp)return!1;if(!t.helpers.isMobile()){ee=q=J=!1,t.events.$on(t.$el,"mousedown",_),t.popups.onShow("image.edit",function(){w(),q=J=!1}),t.popups.onShow("link.edit",function(){w(),q=J=!1}),t.events.on("commands.mousedown",function(e){0<e.parents(".fr-toolbar").length&&w()}),t.events.$on(t.$el,"mouseover","th, td",D),t.events.$on(t.$win,"mouseup",$),t.opts.iframe&&t.events.$on(te(t.o_win),"mouseup",$),t.events.$on(t.$win,"mousemove",L),t.events.$on(te(t.o_win),"scroll",k),t.events.on("contentChanged",function(){0<P().length&&(a(),t.$el.find("img").on("load.selected-cells",function(){te(this).off("load.selected-cells"),0<P().length&&a()}))}),t.events.$on(te(t.o_win),"resize",function(){w()}),t.events.on("toolbar.esc",function(){if(0<P().length)return t.events.disableBlur(),t.events.focus(),!1},!0),t.events.$on(te(t.o_win),"keydown",function(){J&&q&&(q=J=!1,t.$el.removeClass("fr-no-selection"),t.edit.on(),t.selection.setAtEnd(t.$el.find(".fr-selected-cell").last().get(0)),t.selection.restore(),w())}),t.events.$on(t.$el,"keydown",function(l){l.shiftKey?!1===function(a){var l=P();if(null!=l&&0<l.length){var n,r=b(),o=a.which,s=g(1==l.length?n=l[0]:(n=t.el.querySelector(".fr-cell-fixed"),t.el.querySelector(".fr-cell-handler")),r);if(e.KEYCODE.ARROW_RIGHT==o){if(s.col<r[0].length-1)return O(n,r[s.row][s.col+1]),!1}else if(e.KEYCODE.ARROW_DOWN==o){if(s.row<r.length-1)return O(n,r[s.row+1][s.col]),!1}else if(e.KEYCODE.ARROW_LEFT==o){if(0<s.col)return O(n,r[s.row][s.col-1]),!1}else if(e.KEYCODE.ARROW_UP==o&&0<s.row)return O(n,r[s.row-1][s.col]),!1}}(l)&&setTimeout(function(){a()},0):function(a){var l=a.which,n=t.selection.blocks();if(n.length&&("TD"==(n=n[0]).tagName||"TH"==n.tagName)){for(var r=n;r&&"TABLE"!=r.tagName&&r.parentNode!=t.el;)r=r.parentNode;if(r&&"TABLE"==r.tagName&&(e.KEYCODE.ARROW_LEFT==l||e.KEYCODE.ARROW_UP==l||e.KEYCODE.ARROW_RIGHT==l||e.KEYCODE.ARROW_DOWN==l)&&(0<P().length&&x(),t.browser.webkit&&(e.KEYCODE.ARROW_UP==l||e.KEYCODE.ARROW_DOWN==l))){var o=t.selection.ranges(0).startContainer;if(o.nodeType==Node.TEXT_NODE&&(e.KEYCODE.ARROW_UP==l&&(o.previousSibling&&"BR"!==o.previousSibling.tagName||o.previousSibling&&"BR"===o.previousSibling.tagName&&o.previousSibling.previousSibling)||e.KEYCODE.ARROW_DOWN==l&&(o.nextSibling&&"BR"!==o.nextSibling.tagName||o.nextSibling&&"BR"===o.nextSibling.tagName&&o.nextSibling.nextSibling)))return;a.preventDefault(),a.stopPropagation();var s=b(te(r)),i=g(n,s);e.KEYCODE.ARROW_UP==l?M(i,r,s):e.KEYCODE.ARROW_DOWN==l&&S(i,r,s),t.selection.restore()}}}(l)}),t.events.on("keydown",function(l){if(!1===function(a){if(a.which==e.KEYCODE.TAB){var l;if(0<P().length)l=t.$el.find(".fr-selected-cell").last();else{var n=t.selection.element();"TD"==n.tagName||"TH"==n.tagName?l=te(n):n!=t.el&&(0<te(n).parentsUntil(t.$el,"td").length?l=te(n).parents("td").first():0<te(n).parentsUntil(t.$el,"th").length&&(l=te(n).parents("th").first()))}if(l)return a.preventDefault(),!!(0===t.selection.get().focusOffset&&0<te(t.selection.element()).parentsUntil(t.$el,"ol, ul").length&&(0<te(t.selection.element()).closest("li").prev().length||te(t.selection.element()).is("li")&&0<te(t.selection.element()).prev().length))||(x(),a.shiftKey?0<l.prev().length?F(l.prev()):0<l.closest("tr").length&&0<l.closest("tr").prev().length?F(l.closest("tr").prev().find("td").last()):0<l.closest("tbody").length&&0<l.closest("table").find("thead tr").length&&F(l.closest("table").find("thead tr th").last()):0<l.next().length?F(l.next()):0<l.closest("tr").length&&0<l.closest("tr").next().length?F(l.closest("tr").next().find("td").first()):0<l.closest("thead").length&&0<l.closest("table").find("tbody tr").length?F(l.closest("table").find("tbody tr td").first()):(l.addClass("fr-selected-cell"),f("below"),w(),F(l.closest("tr").next().find("td").first())),t.selection.restore(),!1)}}(l))return!1;var n=P();if(0<n.length){if(0<n.length&&t.keys.ctrlKey(l)&&l.which==e.KEYCODE.A)return w(),t.popups.isVisible("table.edit")&&t.popups.hide("table.edit"),n=[],!0;if(l.which==e.KEYCODE.ESC&&t.popups.isVisible("table.edit"))return w(),t.popups.hide("table.edit"),l.preventDefault(),l.stopPropagation(),l.stopImmediatePropagation(),!(n=[]);if(1<n.length&&(l.which==e.KEYCODE.BACKSPACE||l.which==e.KEYCODE.DELETE)){t.undo.saveStep();for(var r=0;r<n.length;r++)te(n[r]).html("<br>"),r==n.length-1&&te(n[r]).prepend(e.MARKERS);return t.selection.restore(),t.undo.saveStep(),!(n=[])}if(1<n.length&&l.which!=e.KEYCODE.F10&&!t.keys.isBrowserAction(l))return l.preventDefault(),!(n=[])}else if(!(n=[])===function(l){if(l.altKey&&l.which==e.KEYCODE.SPACE){var n,r=t.selection.element()
;if("TD"==r.tagName||"TH"==r.tagName?n=r:0<te(r).closest("td").length?n=te(r).closest("td").get(0):0<te(r).closest("th").length&&(n=te(r).closest("th").get(0)),n)return l.preventDefault(),O(n,n),a(),!1}}(l))return!1},!0);var l=[];t.events.on("html.beforeGet",function(){l=P();for(var e=0;e<l.length;e++)l[e].className=(l[e].className||"").replace(/fr-selected-cell/g,"")}),t.events.on("html.afterGet",function(){for(var e=0;e<l.length;e++)l[e].className=(l[e].className?l[e].className.trim()+" ":"")+"fr-selected-cell";l=[]}),r(!0),s(!0)}t.events.on("destroy",V)},insert:function(a,l){var n,r,o="<table "+(t.opts.tableDefaultWidth?'style="width: '+t.opts.tableDefaultWidth+';" ':"")+'class="fr-inserted-table"><tbody>',s=100/l;for(n=0;n<a;n++){for(o+="<tr>",r=0;r<l;r++)o+="<td"+(t.opts.tableDefaultWidth?' style="width: '+s.toFixed(4)+'%;"':"")+">",0===n&&0===r&&(o+=e.MARKERS),o+="<br></td>";o+="</tr>"}o+="</tbody></table>",t.html.insert(o),t.selection.restore();var i=t.$el.find(".fr-inserted-table");i.removeClass("fr-inserted-table"),t.events.trigger("table.inserted",[i.get(0)])},remove:i,insertRow:f,deleteRow:function(){var e=j();if(0<e.length){var a,l,n,r=b(),o=E(r);if(null==o)return;if(0===o.min_i&&o.max_i==r.length-1)i();else{for(a=o.max_i;a>=o.min_i;a--){for(n=te(e.find("tr").not(e.find("> table tr")).get(a)),l=0;l<r[a].length;l++)if(0===l||r[a][l]!=r[a][l-1]){var s=te(r[a][l]);if(1<parseInt(s.attr("rowspan"),10)){var f=parseInt(s.attr("rowspan"),10)-1;1==f?s.removeAttr("rowspan"):s.attr("rowspan",f)}if(a<r.length-1&&r[a][l]==r[a+1][l]&&(0===a||r[a][l]!=r[a-1][l])){for(var c=r[a][l],d=l;0<d&&r[a][d]==r[a][d-1];)d--;0===d?te(e.find("tr").not(e.find("> table tr")).get(a+1)).prepend(c):te(r[a+1][d-1])[0].parentNode&&te(r[a+1][d-1])[0].insertAdjacentElement("afterend",c)}}var p=n.parent();n.remove(),0===p.find("tr").length&&p.remove(),r=b(e)}h(0,r.length-1,0,r[0].length-1,e),0<o.min_i?t.selection.setAtEnd(r[o.min_i-1][0]):t.selection.setAtEnd(r[0][0]),t.selection.restore(),t.popups.hide("table.edit")}}},insertColumn:function(e){var l=j();if(0<l.length){var n,r=b(),o=E(r);n="before"==e?o.min_j:o.max_j;var s,i=100/r[0].length,f=100/(r[0].length+1);l.find("th, td").each(function(){(s=te(this)).data("old-width",s.outerWidth()/l.outerWidth()*100)}),l.find("tr").not(l.find("> table tr")).each(function(t){for(var a,l=te(this),o=0,s=0;o-1<n;){if(!(a=l.find("> th, > td").get(s))){a=null;break}a==r[t][o]?(o+=parseInt(te(a).attr("colspan"),10)||1,s++):(o+=parseInt(te(r[t][o]).attr("colspan"),10)||1,"after"==e&&(a=0===s?-1:l.find("> th, > td").get(s-1)))}var c,d=te(a);if("after"==e&&n<o-1||"before"==e&&0<n&&r[t][n]==r[t][n-1]){if(0===t||0<t&&r[t][n]!=r[t-1][n]){var p=parseInt(d.attr("colspan"),10)+1;d.attr("colspan",p),d.css("width",(d.data("old-width")*f/i+f).toFixed(4)+"%"),d.removeData("old-width")}}else c=0<l.find("th").length?'<th style="width: '.concat(f.toFixed(4),'%;"><br></th>'):'<td style="width: '.concat(f.toFixed(4),'%;"><br></td>'),-1==a?l.prepend(c):null==a?l.append(c):"before"==e?d.before(c):"after"==e&&d[0].parentNode&&d[0].insertAdjacentHTML("afterend",c)}),l.find("th, td").each(function(){(s=te(this)).data("old-width")&&(s.css("width",(s.data("old-width")*f/i).toFixed(4)+"%"),s.removeData("old-width"))}),t.popups.isVisible("table.edit")&&a()}},deleteColumn:function(){var e=j();if(0<e.length){var a,l,n,r=b(),o=E(r);if(null==o)return;if(0===o.min_j&&o.max_j==r[0].length-1)i();else{var s=0;for(a=0;a<r.length;a++)for(l=0;l<r[0].length;l++)(n=te(r[a][l])).hasClass("fr-selected-cell")||(n.data("old-width",n.outerWidth()/e.outerWidth()*100),(l<o.min_j||l>o.max_j)&&(s+=n.outerWidth()/e.outerWidth()*100));for(s/=r.length,l=o.max_j;l>=o.min_j;l--)for(a=0;a<r.length;a++)if(0===a||r[a][l]!=r[a-1][l])if(n=te(r[a][l]),1<(parseInt(n.attr("colspan"),10)||1)){var f=parseInt(n.attr("colspan"),10)-1;1==f?n.removeAttr("colspan"):n.attr("colspan",f),n.css("width",(100*(n.data("old-width")-Y(l,r))/s).toFixed(4)+"%"),n.removeData("old-width")}else{var c=te(n.parent().get(0));n.remove(),0===c.find("> th, > td").length&&(0===c.prev().length||0===c.next().length||c.prev().find("> th[rowspan], > td[rowspan]").length<c.prev().find("> th, > td").length)&&c.remove()}h(0,r.length-1,0,r[0].length-1,e),0<o.min_j?t.selection.setAtEnd(r[o.min_i][o.min_j-1]):t.selection.setAtEnd(r[o.min_i][0]),t.selection.restore(),t.popups.hide("table.edit"),e.find("th, td").each(function(){(n=te(this)).data("old-width")&&(n.css("width",(100*n.data("old-width")/s).toFixed(4)+"%"),n.removeData("old-width"))})}}},mergeCells:function(){if(1<P().length&&(0===t.$el.find("th.fr-selected-cell").length||0===t.$el.find("td.fr-selected-cell").length)){v();var e,l,n=E(b());if(null==n)return;var r=t.$el.find(".fr-selected-cell"),o=te(r[0]),s=o.parent().find(".fr-selected-cell"),i=o.closest("table"),f=o.html(),p=0;for(e=0;e<s.length;e++)p+=te(s[e]).outerWidth();for(o.css("width",Math.min(100,p/i.outerWidth()*100).toFixed(4)+"%"),n.min_j<n.max_j&&o.attr("colspan",n.max_j-n.min_j+1),n.min_i<n.max_i&&o.attr("rowspan",n.max_i-n.min_i+1),e=1;e<r.length;e++)"<br>"!=(l=te(r[e])).html()&&""!==l.html()&&(f+="<br>".concat(l.html())),l.remove();o.html(f),t.selection.setAtEnd(o.get(0)),t.selection.restore(),t.toolbar.enable(),d(n.min_i,n.max_i,i);var h=i.find("tr:empty");for(e=h.length-1;0<=e;e--)te(h[e]).remove();c(n.min_j,n.max_j,i),a()}},splitCellVertically:function(){if(1==P().length){var e=t.$el.find(".fr-selected-cell"),a=parseInt(e.attr("colspan"),10)||1,l=e.parent().outerWidth(),n=e.outerWidth(),r=e.clone().html("<br>"),o=b(),s=g(e.get(0),o);if(1<a){var i=Math.ceil(a/2);n=W(s.col,s.col+i-1,o)/l*100;var f=W(s.col+i,s.col+a-1,o)/l*100;1<i?e.attr("colspan",i):e.removeAttr("colspan"),1<a-i?r.attr("colspan",a-i):r.removeAttr("colspan"),e.css("width",n.toFixed(4)+"%"),r.css("width",f.toFixed(4)+"%")}else{var c;for(c=0;c<o.length;c++)if(0===c||o[c][s.col]!=o[c-1][s.col]){var d=te(o[c][s.col]);if(!d.is(e)){var p=(parseInt(d.attr("colspan"),10)||1)+1;d.attr("colspan",p)}}n=n/l*100/2,e.css("width","".concat(n.toFixed(4),"%")),r.css("width","".concat(n.toFixed(4),"%"))}e[0].parentNode&&e[0].insertAdjacentElement("afterend",r[0]),w(),t.popups.hide("table.edit")}},splitCellHorizontally:function(){if(1==P().length){var e=t.$el.find(".fr-selected-cell"),a=e.parent(),l=e.closest("table"),n=parseInt(e.attr("rowspan"),10),r=b(),o=g(e.get(0),r),s=e.clone().html("<br>");if(1<n){var i=Math.ceil(n/2);1<i?e.attr("rowspan",i):e.removeAttr("rowspan"),1<n-i?s.attr("rowspan",n-i):s.removeAttr("rowspan");for(var f=o.row+i,c=0===o.col?o.col:o.col-1;0<=c&&(r[f][c]==r[f][c-1]||0<f&&r[f][c]==r[f-1][c]);)c--;-1==c?te(l.find("tr").not(l.find("> table tr")).get(f)).prepend(s):te(r[f][c])[0].parentNode&&te(r[f][c])[0].insertAdjacentElement("afterend",s[0])}else{var d,p=te(document.createElement("tr")).append(s);for(d=0;d<r[0].length;d++)if(0===d||r[o.row][d]!=r[o.row][d-1]){var h=te(r[o.row][d]);h.is(e)||h.attr("rowspan",(parseInt(h.attr("rowspan"),10)||1)+1)}a[0].parentNode&&a[0].insertAdjacentElement("afterend",p[0])}w(),t.popups.hide("table.edit")}},addHeader:function(){var e=j();if(0<e.length&&0===e.find("th").length){var t,l="<thead><tr>",n=0;for(e.find("tr").first().find("> td").each(function(){var e=te(this);n+=parseInt(e.attr("colspan"),10)||1}),t=0;t<n;t++)l+="<th><br></th>";l+="</tr></thead>",e.prepend(l),a()}},removeHeader:function(){var e=j(),l=e.find("thead");if(0<l.length)if(0===e.find("tbody tr").length)i();else if(l.remove(),0<P().length)a();else{t.popups.hide("table.edit");var n=e.find("tbody tr").first().find("td").first().get(0);n&&(t.selection.setAtEnd(n),t.selection.restore())}},setBackground:u,showInsertPopup:function(){var e=t.$tb.find('.fr-command[data-cmd="insertTable"]'),a=t.popups.get("table.insert");if(a||(a=r()),!a.hasClass("fr-active")){t.popups.refresh("table.insert"),t.popups.setContainer("table.insert",t.$tb);var l=t.button.getPosition(e),n=l.left,o=l.top;t.popups.show("table.insert",n,o,e.outerHeight())}},showEditPopup:a,showColorsPopup:l,back:function(){0<P().length?a():(t.popups.hide("table.insert"),t.toolbar.showInline())},verticalAlign:function(e){t.$el.find(".fr-selected-cell").css("vertical-align",e)},horizontalAlign:function(e){t.$el.find(".fr-selected-cell").css("text-align",e)},applyStyle:function(e,t,a,l){if(0<t.length){if(!a){var n=Object.keys(l);n.splice(n.indexOf(e),1),t.removeClass(n.join(" "))}t.toggleClass(e)}},selectedTable:j,selectedCells:P,customColor:function(){var e=t.popups.get("table.colors").find(".fr-table-colors-hex-layer input");e.length&&u(e.val())},selectCells:O}},e.DefineIcon("insertTable",{NAME:"table",SVG_KEY:"insertTable"}),e.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker").length&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),e.RegisterCommand("tableInsert",{callback:function(e,t,a){this.table.insert(t,a),this.popups.hide("table.insert")}}),e.DefineIcon("tableHeader",{NAME:"header",FA5NAME:"heading",SVG_KEY:"tableHeader"}),e.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,toggle:!0,callback:function(){this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]').hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(e){var t=this.table.selectedTable();0<t.length&&(0===t.find("th").length?e.removeClass("fr-active").attr("aria-pressed",!1):e.addClass("fr-active").attr("aria-pressed",!0))}}),e.DefineIcon("tableRows",{NAME:"bars",SVG_KEY:"row"}),e.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below","delete":"Delete row"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.tableRows.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableRows" data-param1="'+l+'" title="'+this.language.translate(a[l])+'">'+this.language.translate(a[l])+"</a></li>");return t+"</ul>"},callback:function(e,t){"above"==t||"below"==t?this.table.insertRow(t):this.table.deleteRow()}}),e.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90",SVG_KEY:"columns"}),e.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after","delete":"Delete column"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.tableColumns.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableColumns" data-param1="'.concat(l,'" title="').concat(this.language.translate(a[l]),'">').concat(this.language.translate(a[l]),"</a></li>"));return t+"</ul>"},callback:function(e,t){"before"==t||"after"==t?this.table.insertColumn(t):this.table.deleteColumn()}}),e.DefineIcon("tableCells",{NAME:"square-o",FA5NAME:"square",SVG_KEY:"cellOptions"}),e.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.tableCells.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCells" data-param1="'.concat(l,'" title="').concat(this.language.translate(a[l]),'">').concat(this.language.translate(a[l]),"</a></li>"));return t+"</ul>"},callback:function(e,t){"merge"==t?this.table.mergeCells():"vertical-split"==t?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(e,t){1<this.$el.find(".fr-selected-cell").length?(t.find('a[data-param1="vertical-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="horizontal-split"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="merge"]').removeClass("fr-disabled").attr("aria-disabled",!1)):(t.find('a[data-param1="merge"]').addClass("fr-disabled").attr("aria-disabled",!0),t.find('a[data-param1="vertical-split"]').removeClass("fr-disabled").attr("aria-disabled",!1),t.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled").attr("aria-disabled",!1))}}),e.DefineIcon("tableRemove",{NAME:"trash",SVG_KEY:"removeTable"}),e.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),e.DefineIcon("tableStyle",{NAME:"paint-brush",SVG_KEY:"tableStyle"}),e.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableStyle" data-param1="'.concat(a,'" title="').concat(this.language.translate(t[a]),'">').concat(this.language.translate(t[a]),"</a></li>"));return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(e,t){var a=this.$,l=this.$el.find(".fr-selected-cell").closest("table");l&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=l.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.DefineIcon("tableCellBackground",{NAME:"tint",SVG_KEY:"cellBackground"}),e.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,popup:!0,callback:function(){this.table.showColorsPopup()}}),e.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(e,t){this.table.setBackground(t)}}),e.DefineIcon("tableBack",{NAME:"arrow-left",SVG_KEY:"back"}),e.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(e){0!==this.table.selectedCells().length||this.opts.toolbarInline?(e.removeClass("fr-hidden"),e.next(".fr-separator").removeClass("fr-hidden")):(e.addClass("fr-hidden"),e.next(".fr-separator").addClass("fr-hidden"))}}),e.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v",FA5NAME:"arrows-alt-v",SVG_KEY:"verticalAlignMiddle"}),e.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.tableCellVerticalAlign.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellVerticalAlign" data-param1="'.concat(l.toLowerCase(),'" title="').concat(this.language.translate(a[l]),'">').concat(this.language.translate(l),"</a></li>"));return t+"</ul>"},callback:function(e,t){this.table.verticalAlign(t)},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("align-left",{NAME:"align-left",SVG_KEY:"alignLeft"}),e.DefineIcon("align-right",{NAME:"align-right",SVG_KEY:"alignRight"}),e.DefineIcon("align-center",{NAME:"align-center",SVG_KEY:"alignCenter"}),e.DefineIcon("align-justify",{NAME:"align-justify",SVG_KEY:"alignJustify"}),e.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var t='<ul class="fr-dropdown-list" role="presentation">',a=e.COMMANDS.tableCellHorizontalAlign.options;for(var l in a)a.hasOwnProperty(l)&&(t+='<li role="presentation"><a class="fr-command fr-title" tabIndex="-1" role="option" data-cmd="tableCellHorizontalAlign" data-param1="'.concat(l,'" title="').concat(this.language.translate(a[l]),'">').concat(this.icon.create("align-".concat(l)),'<span class="fr-sr-only">').concat(this.language.translate(a[l]),"</span></a></li>"));return t+"</ul>"},callback:function(e,t){this.table.horizontalAlign(t)},refresh:function(e){var t=this.table.selectedCells(),a=this.$;t.length&&e.find("> *").first().replaceWith(this.icon.create("align-".concat(this.helpers.getAlignment(a(t[0])))))},refreshOnShow:function(e,t){t.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell").first())+'"]').addClass("fr-active").attr("aria-selected",!0)}}),e.DefineIcon("tableCellStyle",{NAME:"magic",SVG_KEY:"cellStyle"}),e.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var e='<ul class="fr-dropdown-list" role="presentation">',t=this.opts.tableCellStyles;for(var a in t)t.hasOwnProperty(a)&&(e+='<li role="presentation"><a class="fr-command" tabIndex="-1" role="option" data-cmd="tableCellStyle" data-param1="'.concat(a,'" title="').concat(this.language.translate(t[a]),'">').concat(this.language.translate(t[a]),"</a></li>"));return e+"</ul>"},callback:function(e,t){this.table.applyStyle(t,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(e,t){var a=this.$,l=this.$el.find(".fr-selected-cell").first();l&&t.find(".fr-command").each(function(){var e=a(this).data("param1"),t=l.hasClass(e);a(this).toggleClass("fr-active",t).attr("aria-selected",t)})}}),e.RegisterCommand("tableCellBackgroundCustomColor",{title:"OK",undo:!0,callback:function(){this.table.customColor()}}),e.DefineIcon("tableColorRemove",{NAME:"eraser",SVG_KEY:"remove"})});