<div class="container">
    <div class="mypage-title">イベント情報</div>
    <p>掲載されているイベント情報をまとめています！<br>登録情報に基づいたおすすめイベント情報については<a href="#">こちら</a>。</p>
    <div class="content-companies-index">
        <div class="search-box">
            <div class="search-title">
                <p>絞り込み条件</p>
            </div>
            <div class="search-category">
                <div class="search-category-title">
                    <% if @CategoriesSearch.blank? %>
                    <input type="checkbox" class="search-way" id="label1" />
                    <% else %>
                    <input type="checkbox" class="search-way" id="label1" checked="true"/>
                    <% end %>
                    <label for="label1" class="search-way-title">イベント種別</label>
                    <div class="search-category-item hidden-show">
                        <% if params[:category] %>
                            <%= check_box_tag :category, 1 , @CategoriesSearch.include?(1), class:"category"%>
                            <%= label_tag '本選考' %><br>
                            <%= check_box_tag :category, 2 , @CategoriesSearch.include?(2), class:"category"%>
                            <%= label_tag 'インターン・ジョブ' %><br>
                            <%= check_box_tag :category, 3 , @CategoriesSearch.include?(3), class:"category"%>
                            <%= label_tag '説明会・企業セミナー' %><br>
                            <%= check_box_tag :category, 4 , @CategoriesSearch.include?(4), class:"category"%>
                            <%= label_tag '合同説明会・交流会' %><br>
                            <%= check_box_tag :category, 5 , @CategoriesSearch.include?(5), class:"category"%>
                            <%= label_tag '就活対策' %><br>
                        <% else %>
                            <%= check_box_tag :category, 1 ,checked = false , class:"category"%>
                            <%= label_tag '本選考' %><br>
                            <%= check_box_tag :category, 2 , checked = false, class:"category"%>
                            <%= label_tag 'インターン・ジョブ' %><br>
                            <%= check_box_tag :category, 3 , checked = false , class:"category"%>
                            <%= label_tag '説明会・企業セミナー' %><br>
                            <%= check_box_tag :category, 4 , checked = false, class:"category"%>
                            <%= label_tag '合同説明会・交流会' %><br>
                            <%= check_box_tag :category, 5 , checked = false, class:"category"%>
                            <%= label_tag '就活対策' %><br>
                        <% end %>
                    </div>
                </div>
                <div class="search-category-title">
                    <% if @IndustriesSearch.blank? %>
                    <input type="checkbox" class="search-way" id="label2" />
                    <% else %>
                    <input type="checkbox" class="search-way" id="label2" checked="true" />
                    <% end %>
                    <label for="label2" class="search-way-title">業界</label>
                    <div class="search-category-item hidden-show">
                        <% if params[:industry] %>
                            <% @industries.each do |i| %>
                                <%= check_box_tag :industry, i.id , @IndustriesSearch.include?(i.id), class:"category"%>
                                <%= label_tag i.name %><br>
                            <% end %>
                        <% else %>
                            <% @industries.each do |i| %>
                                <%= check_box_tag :industry, i.id ,checked = false, class:"category"%>
                                <%= label_tag i.name %><br>
                            <% end %>
                        <% end %>
                    </div>
                </div>
                <div class="search-category-title">
                    <% if @AreasSearch.blank? %>
                    <input type="checkbox" class="search-way" id="label3" />
                    <% else %>
                    <input type="checkbox" class="search-way" id="label3" checked="true" />
                    <% end %>
                    <label for="label3" class="search-way-title">地域</label>
                    <div class="search-category-item hidden-show">
                        <% if params[:area] %>
                            <% @WorkAreas.each do |i| %>
                                <%= check_box_tag :work_area, i.id , @AreasSearch.include?(i.id),class:"category"%>
                                <%= label_tag i.name %><br>
                            <% end %>
                        <% else %>
                            <% @WorkAreas.each do |i| %>
                                <%= check_box_tag :work_area, i.id ,checked = false,class:"category"%>
                                <%= label_tag i.name %><br>
                            <% end %>
                        <% end %>
                    </div>
                    <div class="search-category-title">
                        <% if @WorkStylesSearch.blank? %>
                        <input type="checkbox" class="search-way" id="label4" />
                        <% else %>
                        <input type="checkbox" class="search-way" id="label4" checked="true" />
                        <% end %>
                        <label for="label4" class="search-way-title">働き方</label>
                        <div class="search-category-item hidden-show">
                            <% if params[:work_style] %>
                                <% @WorkStyles.each do |i| %>
                                    <%= check_box_tag :work_style, i.id , @WorkStylesSearch.include?(i.id), class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% else %>
                                <% @WorkStyles.each do |i| %>
                                    <%= check_box_tag :work_style, i.id ,checked = false, class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% end %>
                        </div>
                    </div>
                    <div class="search-category-title">
                        <% if @WelfaresSearch.blank? %>
                        <input type="checkbox" class="search-way" id="label5" />
                        <% else %>
                        <input type="checkbox" class="search-way" id="label5" checked="true" />
                        <% end %>
                        <label for="label5" class="search-way-title">福利厚生</label>
                        <div class="search-category-item hidden-show">
                            <% if params[:welfare] %>
                                <% @welfares.each do |i| %>
                                    <%= check_box_tag :welfare, i.id , @WelfaresSearch.include?(i.id),class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% else %>
                                <% @welfares.each do |i| %>
                                    <%= check_box_tag :welfare, i.id ,checked = false,class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% end %>
                        </div>
                    </div>
                    <div class="search-category-title">
                        <% if @FeaturesSearch.blank? %>
                        <input type="checkbox" class="search-way" id="label6" />
                        <% else %>
                        <input type="checkbox" class="search-way" id="label6" checked="true" />
                        <% end %>
                        <label for="label6" class="search-way-title">企業の特徴</label>
                        <div class="search-category-item hidden-show">
                            <% if params[:feature] %>
                                <% @features.each do |i| %>
                                    <%= check_box_tag :company_feature, i.id,@FeaturesSearch.include?(i.id) , class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% else %>
                                <% @features.each do |i| %>
                                    <%= check_box_tag :company_feature, i.id,checked = false , class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% end %>
                        </div>
                    </div>
                    <div class="search-category-title">
                        <% if @PointsSearch.blank? %>
                        <input type="checkbox" class="search-way" id="label7" />
                        <% else %>
                        <input type="checkbox" class="search-way" id="label7" checked="true" />
                        <% end %>
                        <label for="label7" class="search-way-title">選考の特徴</label>
                        <div class="search-category-item hidden-show">
                            <% if params[:point] %>
                                <% @points.each do |i| %>
                                    <%= check_box_tag :company_point, i.id,@PointsSearch.include?(i.id) , class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% else %>
                                <% @points.each do |i| %>
                                    <%= check_box_tag :company_point, i.id,checked = false , class:"category"%>
                                    <%= label_tag i.name %><br>
                                <% end %>
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="company-contents" id="event-results">
            <% if params[:industry] %>
                <div class="events-searches">
                    <% @get_events.each do |a| %>
                    <div class="events-search">
                        <div class="events-search-head">
                            <%=image_tag a.img.to_s %>
                        </div>
                        <div class="events-search-title">
                            <% if a.company_id.present? %>
                                <%= image_tag Company.find_by(id: a.company_id).icon.to_s %>
                            <% end %>
                            <p><a href="/events/<%=a.id %>"></a><%= a.name %></p>
                        </div>
                        <div class="events-search-schedules">
                            <% a.event_schedules.each do |c| %>
                            <div class="events-search-schedule">
                                <div class="entry-area">
                                    <div class="event-title">
                                        <h2><%= c.title %></h2>
                                        <% if c.holding_day.present? %>
                                            <img src="/assets/clock.svg">
                                            <p class="entry-date"><%= c.holding_day.strftime("%m/%d") %><%= %w((日) (月) (火) (水) (木) (金) (土))[c.holding_day.wday] %></p>
                                        <% end %>
                                        <% if c.start_time.present? && c.end_time.present? %>
                                            <p class="entry-time"><%= c.start_time.strftime('%H:%M') %> - <%= c.end_time.strftime('%H:%M') %></p>
                                        <% end %>
                                        <% if c.address.present? && c.place.present? %>
                                            <img src="/assets/location.svg">
                                            <p class="entry-location"><%= c.address + c.place%></p>
                                        <% end %>
                                    </div>
                                    <% if c.deadline.present? %>
                                        <div class="event-entry">
                                            <p>締切 <%= c.deadline.strftime("%m月%d日") %><%= %w((日) (月) (火) (水) (木) (金) (土))[c.deadline.wday] %>）</p>
                                        </div>
                                    <% end %>
                                </div>
                            </div>
                            <% end %>
                        </div>
                        <a href="/events/<%= a.id %>" class="events-show-link">詳細を見る</a>
                    </div>
                    <% end %>
                </div>
                <%= paginate(@get_events) %>
            <% else %>
                <% if logged_in? && current_user.status == 'core_registered' %>
                <div class="recomended-search" id="recomended-first">
                    <p>あなたにオススメな検索</p>
                    <div class="recomended-search-contents">
                        <div class="recomended-before second">
                            <img src="/assets/progress_bar.svg">
                        </div>
                        <% @user.work_styles.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する働き方.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=<%= i.id %>&welfare=&feature=&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.welfares.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する福利厚生.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=&welfare=<%= i.id %>&feature=&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.company_features.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する企業の特徴.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=&welfare=&feature=<%= i.id %>&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.company_points.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する採用の特徴.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=&welfare=&feature=&point=<%= i.id %>"></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.industries.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/志望業界.svg">
                            <p><a href="/companies?industry=<%= i.id %>&area=&occupation=&work_style=&welfare=&feature=&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <div class="recomended-after second">
                            <img src="/assets/progress_bar2.svg">
                        </div>
                    </div>
                </div>
                <div class="recomended-search" id="recomended-second">
                    <p>あなたにオススメな検索</p>
                    <div class="recomended-search-contents">
                        <div class="recomended-before first">
                            <img src="/assets/progress_bar.svg">
                        </div>
                        <% @user.work_areas.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/志望勤務エリア.svg">
                            <p><a href="/companies?industry=&area=<%= i.id %>&occupation=&work_style=&welfare=&feature=&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.company_points.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する採用の特徴.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=&welfare=&feature=&point=<%= i.id %>"></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.occupations.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/志望職種.svg">
                            <p><a href="/companies?industry=&area=&occupation=<%= i.id %>&work_style=&welfare=&feature=&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.welfares.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する福利厚生.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=&welfare=<%= i.id %>&feature=&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <% @user.company_features.order("RANDOM()").limit(1).each do |i| %>
                        <div class="recomended-search-content first">
                            <img src="/assets/重視する企業の特徴.svg">
                            <p><a href="/companies?industry=&area=&occupation=&work_style=&welfare=&feature=<%= i.id %>&point="></a><%= i.name %></p>
                        </div>
                        <% end %>
                        <div class="recomended-after first">
                            <img src="/assets/progress_bar2.svg">
                        </div>
                    </div>
                </div>
                <% else %>
                <div class="recomended-search">
                    <p>あなたにオススメな検索</p>
                    <div class="recomended-search-contents">
                        <div class="recomended-before">
                            <img src="/assets/progress_bar.svg">
                        </div>
                        <div class="recomended-search-contents">
                            
                        </div>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する企業の特徴.svg">
                            <p>残業なし</p>
                        </div>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する働き方.svg">
                            <p>テレワーク</p>
                        </div>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する福利厚生.svg">
                            <p>育児休暇</p>
                        </div>
                        <div class="recomended-search-content">
                            <img src="/assets/重視する採用の特徴.svg">
                            <p>スニーカーok</p>
                        </div>
                        <div class="recomended-search-content">
                            <img src="/assets/志望業界.svg">
                            <p>広告</p>
                        </div>
                        <div class="recomended-after">
                            <img src="/assets/progress_bar2.svg">
                        </div>
                    </div>
                    <div class="recomended-search-middle">
                            <p>プロフィール登録後に<br>あなた専用のトップリンクに変わります</p>
                    </div>
                </div>
                <% end %>
                <div class="companies-wrapper">
                    <p>注目の新着のイベント</p>
                    <div class="companies-search">
                        <% Event.all.order(id: :desc).limit(8).each do |i| %>
                            <div class="event-search">
                                <%= image_tag i.img.to_s %>
                                <p><a href="/events/<%= i.id %>"></a><%= i.name %></p>
                            </div>
                        <% end %>
                    </div>
                </div>
                <div class="companies-wrapper">
                    <p>IT・インターネット企業のイベント</p>
                    <div class="companies-search">
                        <% Event.includes(:company => :industries).where(industries: { id: 1 }).limit(8).each do |a| %>
                        <div class="event-search">
                            <%=image_tag a.img.to_s %>
                            <p><a href="/events/<%= a.id %>"></a><%= a.name %></p>
                        </div>
                        <% end %>
                    </div>
                </div>
                <div class="companies-wrapper">
                    <p>関東の企業のイベント</p>
                    <div class="companies-search">
                        <% Event.includes(company: :work_areas).where(work_areas: { id: 1 }).limit(8).each do |a| %>
                        <div class="event-search">
                            <%=image_tag a.img.to_s %>
                            <p><a href="/events/<%= a.id %>"></a><%= a.name %></p>
                        </div>
                        <% end %>
                    </div>
                </div>
            <% end %>
        </div>
    </div>
</div>

<script>
    $(document).on('turbolinks:load', function(){
    $('.category').on('change', function(){
    /// チェックされたvalue値を配列として取得
    var category_vals = $('input[name=category]:checked').map(function(){
      return $(this).val();
    }).get();
    var industry_vals = $('input[name=industry]:checked').map(function(){
      return $(this).val();
    }).get();
    var area_vals = $('input[name=work_area]:checked').map(function(){
        return $(this).val();
    }).get();
    var occupation_vals = $('input[name=occupation]:checked').map(function(){
        return  $(this).val();
    }).get();
    var work_style_vals = $('input[name=work_style]:checked').map(function(){
        return  $(this).val();
    }).get();
    var welfare_vals = $('input[name=welfare]:checked').map(function(){
        return  $(this).val();
    }).get();
    var feature_vals = $('input[name=company_feature]:checked').map(function(){
        return  $(this).val();
    }).get();
    var point_vals = $('input[name=company_point]:checked').map(function(){
        return  $(this).val();
    }).get();
    window.location.href = '/events?category=' + category_vals + '&industry=' + industry_vals + '&area=' + area_vals  + '&work_style=' + work_style_vals + '&welfare=' + welfare_vals + '&feature=' + feature_vals + '&point=' + point_vals + '#event-results';
    
  });
    
  $('.section').hide();
    $('#recomended-second').hide();
  
  $('.events-search').click(function(){
        location.href=$(this).find('a').attr('href');
    });
    $('.event-search').click(function(){
        location.href=$(this).find('a').attr('href');
    });
    
    $('#recomended-second').hide();
    $('.second').click(function(){
        $('#recomended-second').show();
        $('#recomended-first').hide();
    });
    $('.first').click(function(){
        $('#recomended-first').show();
        $('#recomended-second').hide();
    });
    
    $('.recomended-search-content').click(function(){
        location.href=$(this).find('a').attr('href');
    });
   
});
</script>