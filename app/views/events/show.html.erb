<div class="container">
    <a href="javascript:history.back()" class="profile-mypage-link"><イベント結果に戻る</a>
    <div class="company-middle">
        <div class="company-middle-left">
            <div class="event-top-wrapper">
              <div class="event-img">
                  <%= image_tag @event.img.to_s, class:"event-top-img" %>
              </div>
              <div class="event-head">
                  <div class="event-head-right">
                 <% Company.joins(:events).where(events:{id:[@event.id]}).each do |i| %>
                 <%=image_tag i.icon.to_s %>
                 <% end %>
                 </div>
                 <div class="event-head-title">
                     <p><%=@event.name%></p>
                 </div>
              </div>
            </div>
            <div class="company-event-information quick-entry sm-version">
                <div class="company-event-head">簡単エントリー</div>
                <%= form_with url: new_event_entry_path(@event), method: :get, local: true do |f|%>
                <%= f.collection_radio_buttons(:event_schedule , @event_schedule, :id, :id ) do |b| %>
                <div class="company-event-quick">
                    <div class="company-event-quick-left">
                        <%= b.radio_button %>
                        <%= EventSchedule.find(b.text).holding_day.strftime("%m/%d") %>
                    </div>
                    <div class="company-event-quick-right">
                        <p><%= EventSchedule.find(b.text).start_time.strftime('%H:%M') %>~<%= EventSchedule.find(b.text).start_time.strftime('%H:%M') %></p>
                        <p><%= EventSchedule.find(b.text).address %></p>
                    </div>
                </div>
                <% end %>
                <%= f.submit 'エントリーする',class: "form-submit", id: "button1" %>
                <% end %>
            </div>
            <div class="company-introduction">
                <div class="company-introduction-title">イベント詳細</div>
                <div class="recruit-form">
                    <div class="recruit-form-left">
                        <p>概要</p>
                    </div>
                    <div class="recruit-form-right">
                        <%= simple_format(@event.introduction) %>
                    </div>
                </div>
                <div class="recruit-form">
                    <div class="recruit-form-left">
                        <p>本ガイダンスのポイント</p>
                    </div>
                    <div class="recruit-form-right">
                        <%= simple_format(@event.point) %>
                    </div>
                </div>
                <div class="recruit-form">
                    <div class="recruit-form-left">
                        <p>当日のプログラム</p>
                    </div>
                    <div class="recruit-form-right">
                        <%= simple_format(@event.flow) %>
                    </div>
                </div>
                <% @event.event_profiles.each do |a| %>
                <div class="recruit-form">
                    <div class="recruit-form-left">
                        <p><%= a.title %></p>
                    </div>
                    <div class="recruit-form-right">
                        <%= simple_format(a.content) %>
                    </div>
                </div>
                <% end %>
                <div class="recruit-form">
                    <div class="recruit-form-left">
                        <p>エントリー</p>
                    </div>
                    <div class="recruit-form-right">
                      <% @event_schedule.each do |event_schedule|%>
                       <div class="entry-area">
                           <div class="event-title">
                               <h2><%=event_schedule.title %></h2>
                               <img src="/assets/clock.svg">
                               <p class="entry-date"><%= event_schedule.holding_day.strftime("%m/%d") %><%= %w((日) (月) (火) (水) (木) (金) (土))[event_schedule.holding_day.wday] %></p>
                               <p class="entry-time"><%= event_schedule.start_time.strftime('%H:%M') %> - <%= event_schedule.end_time.strftime('%H:%M') %></p>
                               <img src="/assets/location.svg">
                               <p class="entry-location"><%= event_schedule.address + event_schedule.place%></p>
                            </div>
                            <div class="event-entry">
                                <p>締切 <%= event_schedule.deadline.strftime("%m月%d日") %><%= %w((日) (月) (火) (水) (木) (金) (土))[event_schedule.deadline.wday] %></p>
                                <div class="entry-button">
                                    <%= link_to 'エントリーする',new_event_entry_path(@event,event_schedule:event_schedule.id)%>
                                </div>
                            </div>
                        </div>
                      <% end %>
                    </div>
                </div>
            </div>
            <div class="company-introduction">
                <div class="company-introduction-title other-introduction"><%= @company.name %>の他の募集情報</div>
                <% if (@company.events.where(category: 1).count >= 2 && @event.category == 1) || (@company.events.where(category: 1).count >= 1 && @event.category != 1) %>
                    <div class="other-event-title">本選考</div>
                    <div class="other-event-content">
                    <% @company.events.where(category: 1).each do |i| %>
                        <% Event.find_by(id: i.id).event_schedules.each do |a| %>
                            <div class="entry-area go-to-other-event">
                                <a href="/events/<%= i.id %>"></a>
                               <div class="event-title">
                                   <h2><%=i.name %></h2>
                                   <img src="/assets/clock.svg">
                                   <p class="entry-date"><%= a.holding_day.strftime("%m/%d") %><%= %w((日) (月) (火) (水) (木) (金) (土))[a.holding_day.wday] %></p>
                                   <p class="entry-time"><%= a.start_time.strftime('%H:%M') %> - <%= a.end_time.strftime('%H:%M') %></p>
                                   <img src="/assets/location.svg">
                                   <p class="entry-location"><%= a.address + a.place%></p>
                                </div>
                                <div class="event-entry">
                                    <p>締切 <%= a.deadline.strftime("%m月%d日") %><%= %w((日) (月) (火) (水) (木) (金) (土))[a.deadline.wday] %></p>
                                </div>
                            </div>
                        <% end %>
                    <% end %>
                    </div>
                <% end %>
                <% if (@company.events.where(category: 2).count >= 2 && @event.category == 2) || (@company.events.where(category: 2).count >= 1 && @event.category != 2) %>
                    <div class="other-event-title">インターンシップ・ジョブ</div>
                    <div class="other-event-content">
                    <% @company.events.where(category: 2).each do |i| %>
                        <% Event.find_by(id: i.id).event_schedules.each do |a| %>
                            <div class="entry-area go-to-other-event">
                                <a href="/events/<%= i.id %>"></a>
                               <div class="event-title">
                                   <h2><%=i.name %></h2>
                                   <img src="/assets/clock.svg">
                                   <p class="entry-date"><%= a.holding_day.strftime("%m/%d") %><%= %w((日) (月) (火) (水) (木) (金) (土))[a.holding_day.wday] %></p>
                                   <p class="entry-time"><%= a.start_time.strftime('%H:%M') %> - <%= a.end_time.strftime('%H:%M') %></p>
                                   <img src="/assets/location.svg">
                                   <p class="entry-location"><%= a.address + a.place%></p>
                                </div>
                                <div class="event-entry">
                                    <p>締切 <%= a.deadline.strftime("%m月%d日") %><%= %w((日) (月) (火) (水) (木) (金) (土))[a.deadline.wday] %></p>
                                </div>
                            </div>
                        <% end %>
                    <% end %>
                    </div>
                <% end %>
                <% if (@company.events.where(category: 3).count >= 2 && @event.category == 3) || (@company.events.where(category: 3).count >= 1 && @event.category != 3) %>
                    <div class="other-event-title">説明会・企業セミナー</div>
                    <div class="other-event-content">
                    <% @company.events.where(category: 3).each do |i| %>
                        <% Event.find_by(id: i.id).event_schedules.each do |a| %>
                            <div class="entry-area go-to-other-event">
                                <a href="/events/<%= i.id %>"></a>
                               <div class="event-title">
                                   <h2><%=i.name %></h2>
                                   <img src="/assets/clock.svg">
                                   <p class="entry-date"><%= a.holding_day.strftime("%m/%d") %><%= %w((日) (月) (火) (水) (木) (金) (土))[a.holding_day.wday] %></p>
                                   <p class="entry-time"><%= a.start_time.strftime('%H:%M') %> - <%= a.end_time.strftime('%H:%M') %></p>
                                   <img src="/assets/location.svg">
                                   <p class="entry-location"><%= a.address + a.place%></p>
                                </div>
                                <div class="event-entry">
                                    <p>締切 <%= a.deadline.strftime("%m月%d日") %><%= %w((日) (月) (火) (水) (木) (金) (土))[a.deadline.wday] %></p>
                                </div>
                            </div>
                        <% end %>
                    <% end %>
                    </div>
                <% end %>
            </div>
        </div>
        <div class="company-middle-right">
            <div class="company-information">
                <div class="company-introduction-title">会社情報</div>
            </div>
            <div class="company-event-information quick-entry pc-version">
                <div class="company-event-head">簡単エントリー</div>
                <%= form_with url: new_event_entry_path(@event), method: :get, local: true do |f|%>
                    <%= f.collection_radio_buttons(:event_schedule , @event_schedule, :id, :id ) do |b| %>
                        <div class="company-event-quick">
                            <div class="company-event-quick-left">
                                <%= b.radio_button %>
                                <%= EventSchedule.find(b.text).holding_day.strftime("%m/%d") %>
                            </div>
                            <div class="company-event-quick-right">
                                <p><%= EventSchedule.find(b.text).start_time.strftime('%H:%M') %>~<%= EventSchedule.find(b.text).start_time.strftime('%H:%M') %></p>
                                <p><%= EventSchedule.find(b.text).address %></p>
                            </div>
                        </div>
                    <% end %>
                    <% if current_user.events.where(id: params[:id]).includes(:user_events).where(user_events: {activate: true}).present? %>
                        <p>エントリー済み</p>
                    <% else %>
                        <%= f.submit 'エントリーする',class: "form-submit", id: "button1" %>
                    <% end %>
                <% end %>
            </div>
        </div>
    </div>
</div>

<script>
$(function() {
	$("#button1").click(function() {

		const str1 = $('input:radio[name="event_schedule"]:checked').val();
		window.location.href = $(location).attr('href') + '/entry/new?event_schedule=' + str1
	});
	
	$('.go-to-other-event').click(function(){
        location.href=$(this).find('a').attr('href');
    });
	
});
;(function() {
  $(document).on("turbolinks:load", function() {
        let item = "",
          itmes = "",
          split = [];
        // Product.nameで商品名称を取得
        item = "#{{@event.id}}";
        // Cookieからproduct_namesに関するデータを取得します。
        items = Cookies.get("event_ids");
        // undefinedでなければデータがproduct_nameに入っている。
        if (items != undefined) {
          items = items + "," + item;
          split = items.split(",");
          // 重複を除去します。
          dup = split.filter(function(a, c, b) {
            return b.indexOf(a) === c;
          });
          Cookies.set("event_ids", dup.join(","));
        } else {
          Cookies.set("event_ids", item);
        }
      });
}.call(this));
</script>