<div class="partner-contents">
    <div class="partner-menus">
        <div class="partner-menu">
            <a href="/partner_page/dashboard">ダッシュボード</a>
        </div>
        <div class="partner-menu">
            <div class="partner-menu-item secList" id="fuu">
                <p>ユーザー管理</p>
                <img src="/assets/partner_bar.svg">
            </div>
            <ul class="partner-menu-lists section fuu">
                <li class="partner-menu-list">
                    <a href="/partner_page/apply">> <span>ユーザー検索</span></a>
                </li>
                <li class="partner-menu-list">
                    <a href="/partner_page/apply">> <span>新規ユーザー登録</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>ジョブ・インターン</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>説明会・企業セミナー</span></a>
                </li>
            </ul>
        </div>
        <div class="partner-menu">
            <div class="partner-menu-item secList" id="guu">
                <p>会社管理</p>
                <img src="/assets/partner_bar.svg">
            </div>
            <ul class="partner-menu-lists section guu">
                <li class="partner-menu-list">
                    <a href="/admin_page/companies">> <span>会社一覧</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>会社検索</span></a>
                </li>
                <li class="partner-menu-list">
                    <a href="/admin_page/companies/new">> <span>新規会社登録</span></a>
                </li>
            </ul>
        </div>
        <div class="partner-menu">
            <div class="partner-menu-item secList" id="nuu">
                <p>イベント管理</p>
                <img src="/assets/partner_bar.svg">
            </div>
            <ul class="partner-menu-lists section nuu">
                <li class="partner-menu-list">
                    <a href="/partner_page/profile">> <span>イベント一覧</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>イベント検索</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>新規イベント登録</span></a>
                </li>
            </ul>
        </div>
        <div class="partner-menu">
            <div class="partner-menu-item secList partner-change" id="muu">
                <p>記事管理</p>
                <img src="/assets/partner_bar.svg">
            </div>
            <ul class="partner-menu-lists section muu">
                <li class="partner-menu-list">
                    <a href="/admin_page/articles">> <span>記事一覧</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>記事検索</span></a>
                </li>
                <li class="partner-menu-list">
                    <a href="/admin_page/articles/new">> <span>新規記事登録</span></a>
                </li>
            </ul>
        </div>
        <div class="partner-menu">
            <div class="partner-menu-item secList ruu">
                <p>広告管理</p>
                <img src="/assets/partner_bar.svg">
            </div>
            <ul class="partner-menu-lists section ruu">
                <li class="partner-menu-list">
                    <a href="#">> <span>本選考</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>ジョブ・インターン</span></a>
                </li>
                <li class="partner-menu-list">
                    <a>> <span>説明会・企業セミナー</span></a>
                </li>
            </ul>
        </div>
    </div>
    <div class="partner-dashboard">
        <h2>記事管理</h2>
        <div class="field">
          <%= simple_form_for(@article, url: admin_page_articles_path) do |f| %>
          <%= f.label :img %>
          <%= f.file_field :img %>
          <%= f.label :title %><br>
          <%= f.text_area :title %><br>
          <%= f.label :content %><br>
          <%= f.input_field :content, class: 'summernote',as: :summernote %><br>
          <div class="form-detail">
                 <p>タグ</p>
                 <div class="profile-core-form">
                     <%= f.collection_check_boxes(:tag_ids,Tag.all, :id, :name) do |hf| %>
                        <%= hf.check_box(class: "checkbox")  %>
                        <%= hf.label(class: "profile-check"){ hf.text } %>
                     <% end %>
                 </div>
          </div>
          <%= f.submit 'Save' %>
          <% end %>
       </div>
    </div>
</div>
<script>
        (function() {
          
          $('.section').hide();
  
          $('.secList').on('click',function(){
                // クリックした要素の ID と違うクラス名のセクションを非表示
            $('.section').not($('.'+$(this).attr('id'))).hide();
            // クリックした要素の ID と同じクラスのセクションを表示
            $('.'+$(this).attr('id')).toggle();
          });
          
          var deleteFile, sendFile;
        
          sendFile = function(file, toSummernote) {
            var data;
            data = new FormData;
            data.append('article_image[image]', file);
            return $.ajax({
              data: data,
              type: 'POST',
              url: '/admin_page/article_images',
              cache: false,
              contentType: false,
              processData: false,
              success: function(data) {
                var img;
                img = document.createElement('IMG');
                img.src = data.url;
                console.log(data);
                img.setAttribute('id', "sn-image-" + data.article_image_id);
                toSummernote.summernote('insertNode', img);
                return toSummernote[0].oldValue = $('.note-editable.card-block')[0].innerHTML;
              }
            });
          };
        
          deleteFile = function(file_id) {
            return $.ajax({
              type: 'DELETE',
              url: "/admin_page/article_images/" + file_id,
              cache: false,
              contentType: false,
              processData: false
            });
          };
        
          Array.prototype.diff = function(a) {
            return this.filter(function(i) {
              return a.indexOf(i) < 0;
            });
          };
        
          $(document).on('turbolinks:load', function() {
            return $('[data-provider="summernote"]').each(function() {
              return $(this).summernote({
                imageAttributes: {
                  	icon: '<i class="note-icon-pencil"/>',
                	figureClass: 'figureClass',
                	figcaptionClass: 'captionClass',
                	captionText: 'Caption Goes Here.',
                	manageAspectRatio: true // true = Lock the Image Width/Height, Default to true
                },
                popover: {
                    image: [
                        ['image', ['resizeFull', 'resizeHalf', 'resizeQuarter', 'resizeNone']],,
                        ['float', ['floatLeft', 'floatRight', 'floatNone']],
                        ['remove', ['removeMedia']],
                        ['custom', ['imageAttributes']],
                    ],
                },
                lang: 'ja-JP',
                toolbar: [
                          ['style', ['style']],
                          ['font', ['bold', 'underline', 'clear', 'fontsizeunit']],
                          ['fontname', ['fontname']],
                          ['fontsize', ['fontsize']],
                          ['color', ['color']],
                          ['strikethrough',['strikethrough']],
                          ['fontsizeunit',['fontsizeunit']],
                          ['para', ['ul', 'ol', 'paragraph']],
                          ['table', ['table']],
                          ['insert', ['link', 'picture', 'video', 'hr']],
                          ['view', ['fullscreen', 'codeview', 'help']],
                        ],
                callbacks: {
                  onInit: function() {
                    console.log('Summernote is launched');
                    return this.oldValue = this.value;
                  },
                  onImageUpload: function(files, e) {
                    console.log("Files were uploaded: ");
                    console.log(files);
                    return sendFile(files[0], $(this));
                  },
                  onMediaDelete: function(target, editor, editable) {
                    var upload_id;
                    console.log(target);
                    console.log("File was deleted : " + target);
                    upload_id = target[0].id.split('-').slice(-1)[0];
                    console.log(upload_id);
                    if (!!upload_id) {
                      deleteFile(upload_id);
                      this.oldValue = $('.note-editable.card-block')[0].innerHTML;
                    }
                    return target.remove();
                  },
                  onKeyup: function(e) {
                    var deletedImage, deletedImages, matches, myRegexp, newImages, newValue, oldImages, _i, _len, _results;
                    if (e.keyCode === 8 || e.keyCode === 46) {
                      newValue = e.target.innerHTML;
                      oldImages = this.oldValue.match(/<img\s(?:.+?)>/g);
                      oldImages = oldImages ? oldImages : [];
                      newImages = newValue.match(/<img\s(?:.+?)>/g);
                      newImages = newImages ? newImages : [];
                      this.oldValue = newValue;
                      deletedImages = newImages ? oldImages.diff(newImages) : [];
                      if (deletedImages.length > 0) {
                        _results = [];
                        for (_i = 0, _len = deletedImages.length; _i < _len; _i++) {
                          deletedImage = deletedImages[_i];
                          myRegexp = /\/uploads\/upload\/image\/(.+?)\/(.+?)\"/g;
                          matches = myRegexp.exec(deletedImage);
                          if (confirm("Are you sure?\nYou can't revert if images have been deleted.")) {
                            deleteFile(matches[1]);
                            _results.push(console.log("* Permanently removed : " + matches[1] + ": " + matches[2]));
                          } else {
                            _results.push(void 0);
                          }
                        }
                        return _results;
                      }
                    }
                  }
                }
              });
            });
          });
        
        }).call(this);
   
</script>